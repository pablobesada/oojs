{"version":3,"sources":["test.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,eAAe,EAAnB;AACA,IAAI,MAAM,EAAV;AACA,aAAa,UAAb,GAA0B,CAAC,MAAD,EAAS,MAAT,CAA1B;AACA,aAAa,mBAAb,GAAmC,aAAa,UAAb,CAAwB,OAAxB,EAAnC;AACA,aAAa,gBAAb,GAAgC,SAAS,gBAAT,CAA0B,OAA1B,EAAmC;AAC/D,SAAK,IAAI,CAAT,IAAc,aAAa,mBAA3B,EAAgD;AAC5C,YAAI,KAAK,aAAa,mBAAb,CAAiC,CAAjC,CAAT;AACA,YAAI,MAAM,QAAQ,WAAR,CAAoB,MAAI,EAAJ,GAAO,GAA3B,CAAV;AACA,YAAI,OAAO,CAAX,EAAc;AACV,mBAAO,EAAP;AACH;AACJ;AACD,WAAO,IAAP;AACH,CATD;;AAWA,aAAa,WAAb,GAA2B,SAAS,WAAT,CAAqB,WAArB,EAAkC,QAAlC,EAA4C;AACnE,QAAI,cAAc,aAAa,iBAAb,CAA+B,YAAY,IAA3C,EAAiD,YAAY,QAA7D,EAAuE,QAAvE,CAAlB;AACA,QAAI,aAAa,YAAY,gBAAZ,CAA6B,WAA7B,EAA0C,QAA1C,CAAjB;AACA,WAAO,UAAP;AACH,CAJD;AAKA,SAAS,OAAT,CAAiB,MAAjB,EAAyB;AACrB,QAAI,UAAU,cAAd,EAA8B,OAAO;AACjC,sBAAc,YADmB;AAEjC,aAAK;AAF4B,KAAP;AAI9B,QAAI,UAAU,YAAd,EAA4B,OAAO,CAAP;AAC/B;;AAED,SAAS,MAAT,GAAiB,CAAE;AACnB,OAAO,QAAP,GAAkB,EAAC,SAAS,OAAV,EAAlB;AACA,QAAQ,IAAR,GAAe,EAAC,SAAS,OAAV,EAAf;;AAEA,IAAI,IAAJ,GAAW,SAAS,IAAT,CAAc,GAAd,EAAmB,QAAnB,EAA6B;;AAEpC,QAAI,MAAM,eAAV;AACA,MAAE,IAAF,CAAO;AACH,cAAM,MADH;AAEH,aAAK,GAFF;AAGH,qBAAa,iCAHV;AAIH,kBAAU,MAJP;AAKH,eAAO,IALJ;AAMH,cAAM,KAAK,SAAL,CAAe,IAAI,MAAJ,EAAf,CANH;AAOH,iBAAS,UAAU,MAAV,EAAkB;AACvB,oBAAQ,GAAR,CAAY,QAAZ;AACA,gBAAI,CAAC,OAAO,EAAZ,EAAgB;AACZ,yBAAS,OAAO,KAAhB;AACA;AACH;AACD,oBAAQ,GAAR,CAAY,MAAZ;AACA,yBAAa,QAAb,CAAsB,iBAAtB,EAAyC,QAAzC,CAAkD,OAAO,GAAzD,EAA8D,GAA9D;AACA,gBAAI,QAAJ,EAAc;AACjB,SAhBE;AAiBH,eAAO,UAAU,KAAV,EAAiB,UAAjB,EAA6B,WAA7B,EAA2C;;AAE9C,kBAAM,WAAN;AACH,SApBE;AAqBH,kBAAU,YAAY;;AAErB;AAvBE,KAAP;AAyBH,CA5BD;;AA8BA,IAAI,IAAJ,GAAW,SAAS,IAAT,CAAc,GAAd,EAAmB,QAAnB,EAA6B;;AAEpC,QAAI,MAAM,eAAV;AACA,MAAE,IAAF,CAAO;AACH,cAAM,MADH;AAEH,aAAK,GAFF;AAGH,qBAAa,iCAHV;AAIH,kBAAU,MAJP;AAKH,eAAO,IALJ;AAMH,cAAM,KAAK,SAAL,CAAe,IAAI,MAAJ,EAAf,CANH;AAOH,iBAAS,UAAU,MAAV,EAAkB;AACvB,oBAAQ,GAAR,CAAY,QAAZ;AACA,gBAAI,CAAC,OAAO,EAAZ,EAAgB;AACZ,oBAAI,QAAJ,EAAc,SAAS,OAAO,KAAhB;AACd;AACH;AACD,oBAAQ,GAAR,CAAY,MAAZ;AACA,yBAAa,QAAb,CAAsB,iBAAtB,EAAyC,QAAzC,CAAkD,OAAO,GAAzD,EAA8D,GAA9D;AACA;AACH,SAhBE;AAiBH,eAAO,UAAU,KAAV,EAAiB,UAAjB,EAA6B,WAA7B,EAA2C;;AAE9C,kBAAM,WAAN;AACH,SApBE;AAqBH,kBAAU,YAAY;;AAErB;AAvBE,KAAP;AAyBH,CA5BD;;AA8BA,IAAI,UAAU,EAAd;AACA,aAAa,QAAb,GAAwB,SAAS,QAAT,CAAkB,IAAlB,EAAwB,oBAAxB,EAA8C;AAClE,QAAI,IAAI,OAAO,GAAP,GAAa,oBAArB;AACA,QAAI,KAAK,OAAT,EAAkB;;AAEd,eAAO,QAAQ,CAAR,CAAP;AACH;AACD,QAAI,MAAM,gBAAV;AACA,QAAI,MAAM,IAAV;AACA,MAAE,IAAF,CAAO;AACH,aAAK,GADF;AAEH,kBAAU,QAFP;AAGH,cAAM,EAAC,MAAM,IAAP,EAAa,sBAAsB,oBAAnC,EAHH;AAIH,eAAO,KAJJ;AAKH,iBAAS,UAAU,MAAV,EAAkB;;AAEvB,kBAAM,gBAAN;AACA,oBAAQ,CAAR,IAAa,GAAb;AACA,gBAAI,CAAC,oBAAL,EAA2B,QAAQ,IAAR,IAAgB,GAAhB;AAC9B,SAVE;AAWH,eAAO,UAAU,KAAV,EAAiB,UAAjB,EAA6B,WAA7B,EAA2C;;AAE9C,oBAAQ,GAAR,CAAY,WAAZ;AACA,kBAAM,WAAN;AACH,SAfE;AAgBH,kBAAU,YAAY;;AAErB;AAlBE,KAAP;AAoBA,WAAO,GAAP;AACH,CA7BD;;AA+BA,aAAa,iBAAb,GAAiC,SAAS,iBAAT,CAA2B,IAA3B,EAAiC,MAAjC,EAAyC,OAAzC,EAAkD;AAC/E,QAAI,IAAI,OAAO,GAAP,GAAa,MAAb,GAAsB,GAAtB,GAA4B,OAApC;AACA,QAAI,KAAK,OAAT,EAAkB;;AAEd,eAAO,QAAQ,CAAR,CAAP;AACH;AACD,QAAI,MAAM,sBAAV;AACA,QAAI,MAAM,IAAV;AACA,MAAE,IAAF,CAAO;AACH,aAAK,GADF;AAEH,kBAAU,QAFP;AAGH,eAAO,KAHJ;AAIH,cAAM,EAAC,MAAM,IAAP,EAAa,QAAQ,MAArB,EAA6B,SAAS,OAAtC,EAJH;AAKH,iBAAS,UAAU,MAAV,EAAkB;AACvB,kBAAM,gBAAN;;AAEA,oBAAQ,CAAR,IAAa,GAAb;AACH,SATE;AAUH,eAAO,UAAU,KAAV,EAAiB,UAAjB,EAA6B,WAA7B,EAA2C;;AAE9C,kBAAM,WAAN;AACH,SAbE;AAcH,kBAAU,YAAY;;AAErB;AAhBE,KAAP;AAkBA,WAAO,GAAP;AACH,CA3BD;;AA+BA,IAAI,KAAK,QAAQ,cAAR,EAAwB,YAAjC;AACA,IAAI,aAAa,GAAG,QAAH,CAAY,YAAZ,CAAjB;AACA,IAAI,KAAK,WAAW,GAAX,EAAT;AACA,GAAG,KAAH,GAAW,GAAX;;;AAGA,GAAG,IAAH,GACK,IADL,CACU,YAAY;AACd,YAAQ,GAAR,CAAY,QAAZ;AACA,YAAQ,GAAR,CAAY,GAAG,QAAf;AACA,YAAQ,GAAR,CAAY,GAAG,KAAH,CAAS,MAArB;AACH,CALL,EAMK,IANL,CAMU,YAAY;AACd,OAAG,QAAH,GAAc,GAAG,QAAH,GAAc,GAA5B;AACA,QAAI,OAAO,GAAG,KAAH,CAAS,MAAT,EAAX;AACA,SAAK,OAAL,GAAe,MAAM,GAAG,KAAH,CAAS,MAA9B;AACA,OAAG,KAAH,CAAS,IAAT,CAAc,IAAd;AACA,OAAG,KAAH,CAAS,CAAT,EAAY,IAAZ,GAAkB,OAAlB;AACA,WAAO,GAAG,IAAH,EAAP;AACH,CAbL,EAcK,IAdL,CAcU,YAAY;AACd,YAAQ,GAAR,CAAY,YAAY,GAAG,QAA3B;AACA,YAAQ,GAAR,CAAY,YAAY,GAAG,KAAH,CAAS,MAAjC;AACH,CAjBL,EAkBK,KAlBL,CAkBW,UAAU,KAAV,EAAiB;AACpB,YAAQ,GAAR,CAAY,KAAK,SAAL,CAAe,KAAf,CAAZ;AACH,CApBL,EAqBK,IArBL,CAqBU,YAAY,CACjB,CAtBL","file":"test-compiled.js","sourcesContent":["\"use strict\";\n\nvar classmanager = {};\nvar orm = {};\nclassmanager.scriptdirs = [\"core\", \"base\"];\nclassmanager.reversed_scriptdirs = classmanager.scriptdirs.reverse()\nclassmanager.extractScriptDir = function extractScriptDir(dirname) {\n    for (var i in classmanager.reversed_scriptdirs) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        var idx = dirname.lastIndexOf(\"/\"+sd+\"/\")\n        if (idx >= 0) {\n            return sd;\n        }\n    }\n    return null;\n}\n\nclassmanager.createClass = function createClass(description, filename) {\n    var ParentClass = classmanager.getParentClassFor(description.name, description.inherits, filename);\n    var ChildClass = ParentClass.createChildClass(description, filename);\n    return ChildClass;\n}\nfunction require(module) {\n    if (module == \"./openorange\") return {\n        classmanager: classmanager,\n        orm: orm\n    }\n    if (module == \"underscore\") return _;\n}\n\nfunction global(){}\nglobal.__main__ = {require: require}\nrequire.main = {require: require}\n\norm.load = function load(rec, callback) {\n    //var jsonrecord = JSON.stringify(record);\n    var url = '/runtime/load';\n    $.ajax({\n        type: \"POST\",\n        url: url,\n        contentType: 'application/json; charset=utf-8',\n        dataType: \"json\",\n        async: true,\n        data: JSON.stringify(rec.toJSON()),\n        success: function (result) {\n            console.log(\"loaded\")\n            if (!result.ok) {\n                callback(result.error);\n                return;\n            }\n            console.log(result)\n            classmanager.getClass(\"Embedded_Record\").fromJSON(result.rec, rec)\n            if (callback) callback();\n        },\n        error: function (jqXHR, textStatus, errorThrown ) {\n            //console.log(\"en fail\")\n            throw errorThrown;\n        },\n        complete: function () {\n            //console.log(\"en load::complete\");\n        }\n    });\n}\n\norm.save = function save(rec, callback) {\n    //var jsonrecord = JSON.stringify(record);\n    var url = '/runtime/save';\n    $.ajax({\n        type: \"POST\",\n        url: url,\n        contentType: 'application/json; charset=utf-8',\n        dataType: \"json\",\n        async: true,\n        data: JSON.stringify(rec.toJSON()),\n        success: function (result) {\n            console.log(\"loaded\")\n            if (!result.ok) {\n                if (callback) callback(result.error);\n                return;\n            }\n            console.log(result)\n            classmanager.getClass(\"Embedded_Record\").fromJSON(result.rec, rec)\n            callback()\n        },\n        error: function (jqXHR, textStatus, errorThrown ) {\n            //console.log(\"en fail\")\n            throw errorThrown;\n        },\n        complete: function () {\n            //console.log(\"en load::complete\");\n        }\n    });\n}\n\nvar classes = {}\nclassmanager.getClass = function getClass(name, max_script_dir_index) {\n    var k = name + \"|\" + max_script_dir_index;\n    if (k in classes) {\n        //console.log(\"getclass: returning \" + name + \" from cache\");\n        return classes[k]\n    }\n    var url = '/runtime/class';\n    var res = null;\n    $.ajax({\n        url: url,\n        dataType: \"script\",\n        data: {name: name, max_script_dir_index: max_script_dir_index},\n        async: false,\n        success: function (result) {\n            //console.log(\"en success: \" + name);\n            res = moduleFunction();\n            classes[k] = res;\n            if (!max_script_dir_index) classes[name] = res;\n        },\n        error: function (jqXHR, textStatus, errorThrown ) {\n            //console.log(\"en fail\")\n            console.log(errorThrown)\n            throw errorThrown;\n        },\n        complete: function () {\n            //console.log(\"en getclass::complete\");\n        }\n    });\n    return res;\n}\n\nclassmanager.getParentClassFor = function getParentClassFor(name, parent, dirname) {\n    var k = name + \"|\" + parent + \"|\" + dirname;\n    if (k in classes) {\n        //console.log(\"getparentclass: returning \" + name + \" from cache\");\n        return classes[k];\n    }\n    var url = '/runtime/parentclass';\n    var res = null;\n    $.ajax({\n        url: url,\n        dataType: \"script\",\n        async: false,\n        data: {name: name, parent: parent, dirname: dirname},\n        success: function (result) {\n            res = moduleFunction();\n            //console.log(\"en parent success: \" + name +\"/\" + parent + \"   \" + res.__filename__);\n            classes[k] = res;\n        },\n        error: function (jqXHR, textStatus, errorThrown ) {\n            //console.log(\"en fail\")\n            throw errorThrown;\n        },\n        complete: function () {\n            //console.log(\"en getparentclass::complete\");\n        }\n    });\n    return res;\n}\n\n\n\nvar cm = require(\"./openorange\").classmanager\nvar SalesOrder = cm.getClass(\"SalesOrder\")\nvar so = SalesOrder.new()\nso.SerNr = 333;\n\n//so.SerNr = 999\nso.load()\n    .then(function () {\n        console.log(\"loaded\")\n        console.log(so.CustCode)\n        console.log(so.Items.length)\n    })\n    .then(function () {\n        so.CustCode = so.CustCode + \"X\";\n        var sorw = so.Items.newRow()\n        sorw.ArtCode = \"I\" + so.Items.length;\n        so.Items.push(sorw);\n        so.Items[1].Name ='PABLO'\n        return so.save()\n    })\n    .then(function () {\n        console.log(\"saved: \" + so.CustCode)\n        console.log(\"items: \" + so.Items.length)\n    })\n    .catch(function (error) {\n        console.log(JSON.stringify(error))\n    })\n    .then(function () {\n    })\n"]}