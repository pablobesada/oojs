{"version":3,"sources":["runtime.js"],"names":[],"mappings":"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","file":"runtime-compiled.js","sourcesContent":["\"use strict\";\n\nvar express = require('express');\nvar router = express.Router();\nvar fs = require(\"fs\")\nvar cm = require('./openorange').classmanager\nvar orm = require('./openorange').orm\nvar Record = cm.getClass(\"Embedded_Record\")\nvar path = require(\"path\")\n/* GET users listing. */\n\nfunction sendModule(res, fn) {\n    fs.readFile(fn, 'utf8', function (err, data) {\n        if (err) {\n            return console.log(err);\n        }\n        var fulldata = \"var moduleFunction = (function() {module = {};\\n\";\n        fulldata = fulldata + \"var __dirname = '\" + path.dirname(fn) + \"';\\n\"\n        fulldata = fulldata + \"var __filename = '\" + fn + \"';\\n\"\n        fulldata = fulldata + data + \"\\nreturn module.exports;})\";\n        res.status(200).send(fulldata)\n    });\n}\n\nrouter.post('/load', function (req, res, next) {\n    console.log(req.body)\n    var rec = Record.fromJSON(req.body)\n    res.setHeader('Content-Type', 'application/json');\n    rec.load()\n        .then(function () {\n            res.send({ok:true, rec: JSON.stringify(rec)});\n        })\n        .catch(function (err) {\n            res.send({ok: false, error: \"record not found\"})\n        });\n});\n\nrouter.post('/store', function (req, res, next) {\n    console.log(req.body)\n    var rec = Record.fromJSON(req.body)\n    res.setHeader('Content-Type', 'application/json');\n    orm.store(rec, function (err) {\n        if (err) {\n            res.send({ok: false, error: err})\n        } else {\n            res.send({ok: true, rec: JSON.stringify(rec)});\n        }\n    })\n});\n\nrouter.get('/class', function (req, res, next) {\n    var cls = cm.getClass(req.query.name, req.query.max_script_dir_index);\n    var fn = cls.__filename__;\n    console.log(fn)\n    sendModule(res, fn);\n});\n\n\nrouter.get('/parentclass', function (req, res, next) {\n    var cls = cm.getParentClassFor(req.query.name, req.query.parent, req.query.dirname)\n    var fn = cls.__filename__;\n    sendModule(res, fn);\n    console.log(fn)\n});\n\nmodule.exports = router;"]}