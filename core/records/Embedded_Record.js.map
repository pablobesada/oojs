{"version":3,"sources":["Embedded_Record.es6"],"names":[],"mappings":"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","file":"Embedded_Record.js","sourcesContent":["//\"use strict\";\nvar oo = require(\"openorange\")\nvar _ = require(\"underscore\")\nvar moment = require(\"momentjs\")\nvar Query = oo.query;\n\n//var Field = Object.create(null);\nclass Field {\n\n    static create(name, type, length, persistent, linkto) {\n        if (type == 'date') return new DateField(name, type, length, persistent, linkto);\n        if (type == 'time') return new TimeField(name, type, length, persistent, linkto);\n        return new Field(name, type, length, persistent, linkto);\n    }\n\n    constructor(name, type, length, persistent, linkto) {\n        this.name = name;\n        this.type = type;\n        this.length = length;\n        this.persistent = persistent;\n        this.linkto = linkto;\n        this.value = null;\n        this.listener = null;\n        return this;\n    }\n\n    getValue() {\n        //console.log(\"en get value: \" + this.value)\n        return this.value;\n    }\n\n    getSQLValue() {\n        //console.log(\"en get value: \" + this.value)\n        return this.value;\n    }\n\n    setValue(v) {\n        if (this.value != v) {\n            var oldvalue = this.value;\n            this.value = v;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n    toString(v) {\n        return this.value != null ? this.value.toString() : null;\n    }\n}\n\n//var DateField = Object.create(Field)\nclass DateField extends Field {\n    constructor(name, type, length, persistent, linkto) {\n        super(name, type, length, persistent, linkto)\n    }\n\n    setValue(v) {\n        var vv;\n        if (v == null) {\n            vv = null;\n        } else if (v instanceof moment) {\n            vv = v\n        } else if (v instanceof Date) {\n            vv = moment(v)\n        } else if (typeof v == 'string') {\n            vv = moment(v, \"YYYY-MM-DD\")\n        } else {\n            vv = null\n        }\n        if (this.value != vv) {\n            var oldvalue = this.value;\n            this.value = vv;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n\n    getSQLValue() {\n        return this.value == null ? null : this.value.format(\"YYYY-MM-DD\");\n    }\n}\n\n//var TimeField = Object.create(Field)\nclass TimeField extends Field {\n    constructor(name, type, length, persistent, linkto) {\n        super(name, type, length, persistent, linkto)\n    }\n\n    setValue(v) {\n        var vv;\n        if (v == null) {\n            vv = null;\n        } else if (v instanceof moment) {\n            vv = v.format(\"HH:mm:ss\")\n        } else if (typeof v == 'string') {\n            vv = v\n        } else {\n            vv = null\n        }\n        if (this.value != vv) {\n            var oldvalue = this.value;\n            this.value = vv;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n    getSQLValue() {\n        return this.value == null ? null : this.value;\n    }\n}\n\n\n\nvar DetailField = Object.create(Array.prototype);\nDetailField.init = function(name, description, listener) {\n    this.name = name;\n    this.__description__ = description;\n    this.type = this.__description__.type\n    this.__rowclass__ = null;\n    this.__removed_rows__ = [];\n    this.listener = listener;\n    return this;\n}\n\nDetailField.getRowClass = function getRowClass() {\n    if (this.__rowclass__ == null) this.__rowclass__ = oo.classmanager.getClass(this.__description__.class);\n    return this.__rowclass__;\n}\n\nDetailField.clearRemovedRows = function clearRemovedRows() {\n    this.__removed_rows__ = [];\n}\n\nDetailField.fieldNames = function fieldNames() {\n    return this.getRowClass().__description__.fieldnames\n}\nDetailField.newRow = function newRow() {\n    return this.getRowClass().new();\n}\n\nDetailField.push = function push(obj) {\n    obj.rowNr = this.length;\n    Array.prototype.push.call(this, obj)\n    obj.addListener(this);\n    if (this.listener) this.listener.rowInserted(this, obj, this.length-1);\n}\n\nDetailField.insert = function insert(obj, pos) {\n    //return this.push(obj)\n    obj.rowNr = pos;\n    Array.prototype.splice.call(this, pos, 0, obj)\n    for (var i=pos+1;i<this.length;i++) {\n        this[i].rowNr = i;\n    }\n    obj.addListener(this);\n    if (this.listener) this.listener.rowInserted(this, obj, pos);\n}\n\nDetailField.clear = function clear() {\n    if (this.length != 0) {\n        this.length = 0;\n        if (this.listener) this.listener.detailCleared(this);\n    }\n}\n\nDetailField.splice = function splice() {\n    var self = this;\n    var removed = Array.prototype.splice.apply(this, arguments)\n    removed.forEach(function (element) {self.__removed_rows__.push(element)});\n    if (removed.length >0) {\n        for (var i=removed[0].rowNr; i<self.length; i++) {\n            self[i].rowNr = i;\n        }\n        if (this.listener) this.listener.fieldModified(this);\n    }\n    return removed;\n}\n\nDetailField.fieldModified = function fieldModified(record, field, oldvalue) {\n    //[].unshift.call(arguments, this);\n    if (this.listener) this.listener.fieldModified.call(this.listener, this, record, field, oldvalue)\n}\n\nvar RecordListener = Object.create(null);\nRecordListener.init = function (fieldModified) {\n    this.fieldModified = fieldModified;\n    return this;\n}\n\nvar FieldsListener = Object.create(null);\nFieldsListener.receiver = null;\nFieldsListener.fieldModified = function () {\n    if (this.receiver != null) this.receiver.fieldModified.apply(this.receiver, arguments);\n}\n\nFieldsListener.rowInserted = function (detail, row, position) {\n    if (this.receiver != null) this.receiver.rowInserted(detail, row, position)\n}\n\nFieldsListener.detailCleared = function (detail, row, position) {\n    if (this.receiver != null) this.receiver.detailCleared(detail)\n}\n\nvar RecordDescription = {\n    name: 'Embedded_Record',\n    inherits: null,\n    fields: {\n        internalId: {type: \"integer\"},\n    },\n    fieldnames: ['internalId'],\n    detailnames: [],\n    filename: __filename\n}\n\n/*\nvar Embedded_Record = Object.create({\n    '__super__': null,\n    '__description__': RecordDescription,\n    '__filename__': __filename,\n})\n*/\n\nfunction propFieldGetter(fn) {\n    return function () {\n        //console.log(\"getting \" + fn + \" : \" + this.__fields__[fn].getValue())\n        return this.__fields__[fn].getValue()\n    }\n}\n\nfunction propFieldSetter(fn) {\n    return function (v) {\n        //console.log(\"setting  \"+  v + \" in \" + fn);\n        return this.__fields__[fn].setValue(v);\n    }\n}\n\nfunction propDetailGetter(fn) {\n    return function () {\n        //console.log(\"getting \" + fn + \" : \" + this.__fields__[fn].getValue())\n        return this.__details__[fn]\n    }\n}\nclass Embedded_Record {\n\n    static new() {\n        var res = new this()\n        return res;\n    }\n\n\n    static initClass(descriptor) {\n        //var childclass = Object.create(this)\n        //console.log(\"en initClass: this.__description__: \" + this.__description__)\n        let parentdesc = this.__description__;\n        let newdesc = {fields: {}, filename: descriptor.filename};\n        for (var fn in parentdesc.fields) {\n            newdesc.fields[fn] = parentdesc.fields[fn];\n        }\n        for (var fn in descriptor.fields) {\n            newdesc.fields[fn] = descriptor.fields[fn];\n        }\n        newdesc.name = descriptor.name;\n        newdesc.fieldnames = _(Object.keys(newdesc.fields)).filter(function (fn) {\n            return newdesc.fields[fn].type != 'detail'\n        })\n        newdesc.detailnames = _(Object.keys(newdesc.fields)).filter(function (fn) {\n            return newdesc.fields[fn].type == 'detail'\n        })\n        this.__super__ = Reflect.getPrototypeOf(this);\n        this.__description__ = newdesc\n        return this;\n    }\n\n    static tryCall(self, defaultResponse, methodname) {\n        if (methodname == null) throw new Error(\"methodname can not be null\")\n        if (methodname in this.prototype) {\n            return this.prototype[methodname].apply(self, Array.prototype.slice.apply(arguments).slice(2));\n        } else {\n            return defaultResponse;\n        }\n    }\n\n    callSuperXXX(methodname, self) {\n        if (methodname in this.__super__) {\n            return this.__super__[methodname].apply(self, Array.prototype.slice.apply(arguments).slice(2));\n        } else {\n            return Promise.resolve();\n        }\n    }\n\n    static getDescription() {\n        return this.__description__\n    }\n\n    constructor() {\n        this.__class__ = this.constructor;\n        this.__isnew__ = true;\n        this.__ismodified__ = false;\n        this.__fields__ = {}\n        this.__oldfields__ = {}\n        this.__details__ = {}\n        this.__fieldslistener__ = Object.create(FieldsListener)\n        this.__fieldslistener__.receiver = this;\n        var props = {}\n        this.__listeners__ = [];\n        this.load = this.load.bind(this)\n        this.store = this.store.bind(this)\n        this.save = this.save.bind(this)\n        this.delete = this.delete.bind(this)\n        let description = this.__class__.getDescription()\n        for (var fn in description.fields) {\n            var fd = description.fields[fn]\n            if (fd.type != 'detail') {\n                this.__oldfields__[fn] = Field.create(fn, fd.type, fd.length, fd.persistent, fd.linkto);\n                this.__fields__[fn] = Field.create(fn, fd.type, fd.length, fd.persistent, fd.linkto);\n                this.__fields__[fn].listener = this.__fieldslistener__;\n                props[fn] = {\n                    enumerable: true,\n                    get: propFieldGetter(fn),\n                    set: propFieldSetter(fn),\n                }\n            } else {\n                this.__details__[fn] = Object.create(DetailField).init(fn, fd, this.__fieldslistener__);\n                props[fn] = {\n                    enumerable: true,\n                    get: propDetailGetter(fn),\n                }\n            }\n        }\n        Object.defineProperties(this, props)\n        return this;\n    }\n\n    fieldModified(p1, p2, p3, p4) { //it could be: {p1: field} or {p1: detail, p2: row, p3: rowfield, p4: oldvalue}\n        this.setModifiedFlag(true);\n        //[].unshift.call(arguments, this);\n        for (var i = 0; i < this.__listeners__.length; i++) {\n            this.__listeners__[i].fieldModified.call(this.__listeners__[i], this, p1, p2, p3, p4);\n        }\n    }\n\n   rowInserted(detail, row, position) { //it could be: {p1: field} or {p1: detail, p2: row, p3: rowfield}\n        this.setModifiedFlag(true);\n        for (var i = 0; i < this.__listeners__.length; i++) {\n            this.__listeners__[i].rowInserted(this, detail, row, position);\n        }\n    }\n\n    detailCleared(detail) {  //{p1: detail}\n        this.setModifiedFlag(true);\n        for (var i = 0; i < this.__listeners__.length; i++) {\n            this.__listeners__[i].detailCleared(this, detail);\n        }\n    }\n\n    addListener(listener) {\n        this.__listeners__.push(listener);\n    }\n\n    fieldNames() {\n        return this.__class__.__description__.fieldnames\n    }\n\n    detailNames() {\n        return this.__class__.__description__.detailnames\n    }\n\n    fields(fn) {\n        return this.__fields__[fn]\n    }\n\n    oldFields(fn) {\n        return this.__oldfields__[fn]\n    }\n\n    details(dn) {\n        return this.__details__[dn]\n    }\n\n    hasField(fn) {\n        return fn in this.__fields__\n    }\n\n    inspect() {\n        return \"<\" + this.__class__.__description__.name + \", from \" + this.__class__.__description__.filename + \">\"\n    }\n\n    __clearRemovedRows__XXX() {\n        _(this.__details__).map(function (detail) {\n            detail._removed_rows__ = []\n        })\n    }\n\n    async save_fromGUI() {\n\n    }\n\n    async save() {\n        let self = this;\n        let was_new = null;\n        let res = await self.check()\n        if (!res) return res;\n        if (self.isNew()) {\n            was_new = true;\n            res = await self.beforeInsert();\n            if (!res) return res;\n        } else {\n            was_new = false;\n            res = await self.beforeUpdate();\n            if (!res) return res;\n        }\n        res = await self.store();\n        if (!res) return res;\n        if (was_new) {\n            await self.afterInsert();\n        } else {\n            await self.afterUpdate();\n        }\n        return true;\n    }\n\n    syncOldFields() {\n        var self = this;\n        _(this.__class__.__description__.fields).forEach(function (fdef, fn) {\n            if (fdef.type != 'detail') {\n                self.oldFields(fn).setValue(self[fn])\n            } else {\n                var detail = self[fn]\n                for (var j = 0; j < detail.length; j++) {\n                    detail[j].syncOldFields();\n                }\n                detail.clearRemovedRows();\n            }\n        })\n        self.setModifiedFlag(false)\n    }\n\n    async defaults() {\n        return;\n    }\n\n    async check() {\n        return true;\n    }\n\n    async beforeInsert() {\n        return true;\n    }\n\n    async beforeUpdate() {\n        return true;\n    }\n\n    async afterInsert() {\n        return true;\n    }\n\n    async afterUpdate() {\n        return true;\n    }\n\n    async store() {\n        var res = await oo.orm.store(this);\n        return res\n    }\n\n    async delete() {\n        return oo.orm.delete(this);\n    }\n\n    async load() {\n        return oo.orm.load(this);\n    }\n\n    static async findOne(whereClause) {\n        let rec = this.new();\n        for (let fn in whereClause) {\n            rec[fn] = whereClause[fn];\n        }\n        let res = await rec.load();\n        if (!res) return null;\n        return rec;\n    }\n\n    static select() {\n        return Query.select(this)\n        //return oo.orm.select(this)\n    }\n\n    isNew() {\n        return this.__isnew__;\n    }\n\n    isModified() {\n        return this.__ismodified__;\n    }\n\n    setModifiedFlag(b) {\n        this.__ismodified__ = b;\n    }\n\n    setNewFlag(b) {\n        return this.__isnew__ = b;\n    }\n\n    toJSON() {\n        var obj = {\n            __meta__: {\n                __isnew__: this.__isnew__,\n                __ismodified__: this.__ismodified__,\n                __classname__: this.__class__.__description__.name\n            },\n            fields: {},\n            oldFields: {},\n            removedRows: {}\n        }\n        var fieldnames = this.fieldNames();\n        for (var i = 0; i < fieldnames.length; i++) {\n            var fn = fieldnames[i];\n            obj.fields[fn] = this.fields(fn).getSQLValue();\n            obj.oldFields[fn] = this.oldFields(fn).getSQLValue();\n        }\n        var detailnames = this.detailNames();\n        for (var i = 0; i < detailnames.length; i++) {\n            var dn = detailnames[i];\n            obj.fields[dn] = [];\n            var detail = this[dn];\n            for (var j = 0; j < detail.length; j++) {\n                obj.fields[dn].push(this[dn][j].toJSON())\n            }\n            obj.removedRows[dn] = []\n            for (var j = 0; j < detail.__removed_rows__.length; j++) {\n                obj.removedRows[dn].push(detail.__removed_rows__[j].toJSON())\n            }\n        }\n        return obj;\n    }\n\n    static fromJSON(obj, rec) {\n        if (typeof obj == \"string\") obj = JSON.parse(obj);\n        if (rec == null) rec = oo.classmanager.getClass(obj.__meta__.__classname__).new();\n        var fieldnames = rec.fieldNames();\n        for (var i = 0; i < fieldnames.length; i++) {\n            var fn = fieldnames[i];\n            rec[fn] = obj.fields[fn]\n            rec.oldFields(fn).setValue(obj.oldFields[fn])\n        }\n        var detailnames = rec.detailNames();\n        for (var i = 0; i < detailnames.length; i++) {\n            var dn = detailnames[i];\n            var detail = rec[dn];\n            detail.clear();\n            for (var j = 0; j < obj.fields[dn].length; j++) {\n                detail.push(detail.getRowClass().fromJSON(obj.fields[dn][j]))\n            }\n            for (var j = 0; j < obj.removedRows[dn].length; j++) {\n                detail.__removed_rows__.push(detail.getRowClass().fromJSON(obj.removedRows[dn][j]))\n            }\n        }\n        rec.setNewFlag(obj.__meta__.__isnew__)\n        rec.setModifiedFlag(obj.__meta__.__ismodified__)\n        return rec;\n    }\n\n    clone() {\n        var newrec = this.__class__.new();\n        var fieldnames = this.fieldNames();\n        for (var i = 0; i < fieldnames.length; i++) {\n            var fn = fieldnames[i];\n            newrec[fn] = this[fn]\n        }\n        var detailnames = this.detailNames();\n        for (var i = 0; i < detailnames.length; i++) {\n            var dn = detailnames[i];\n            var newdetail = newrec[dn];\n            var thisdetail = this[dn];\n            newdetail.clear();\n            for (var j = 0; j < this[dn].length; j++) {\n                newdetail.push(thisdetail[j].clone())\n            }\n        }\n        newrec.setNewFlag(this.isNew())\n        newrec.setModifiedFlag(this.isModified())\n        return newrec;\n    }\n\n    isEqual(rec) {\n        if (rec.prototype != this.prototype) return false;\n        var fieldnames = this.fieldNames();\n        for (var i = 0; i < fieldnames.length; i++) {\n            var fn = fieldnames[i];\n            if (rec[fn] != this[fn]) return false;\n        }\n        var detailnames = this.detailNames();\n        for (var i = 0; i < detailnames.length; i++) {\n            var dn = detailnames[i];\n            var recdetail = rec[dn];\n            var thisdetail = this[dn];\n            if (recdetail.length != thisdetail.length) return false;\n            for (var j = 0; j < this[dn].length; j++) {\n                if (!recdetail[j].isEqual(thisdetail[j])) return false;\n            }\n        }\n        if (rec.isNew() != this.isNew()) return false;\n        if (rec.isModified() != this.isModified()) return false;\n        if (JSON.stringify(rec.toJSON()) != JSON.stringify(this.toJSON())) return false; //ojo con estoooooo es muy pesado me parece... y ademas es redundante, solo aporta la comparacion de oldfields y removedrows\n        return true;\n    }\n\n    fieldIsEditable(fieldname, rowfieldname, rownr) {\n        if (rowfieldname == 'rowNr') return false;\n        return true;\n    }\n\n    ppp() {\n        let session = require('continuation-local-storage').getNamespace('contextSession')\n        let req = session.get('req')\n        console.log(\"A\", req.query)\n    }\n}\nEmbedded_Record.__description__ = RecordDescription\nmodule.exports = Embedded_Record\n"]}