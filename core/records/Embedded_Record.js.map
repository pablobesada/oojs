{"version":3,"sources":["Embedded_Record.es6"],"names":[],"mappings":"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","file":"Embedded_Record.js","sourcesContent":["\"use strict\";\nvar oo = require(\"openorange\")\nvar _ = require(\"underscore\")\nvar moment = require(\"momentjs\")\nvar Query = oo.query;\n\n//var Field = Object.create(null);\nclass Field {\n\n    static create(name, type, length, persistent, linkto) {\n        if (type == 'date') return new DateField(name, type, length, persistent, linkto);\n        if (type == 'time') return new TimeField(name, type, length, persistent, linkto);\n        return new Field(name, type, length, persistent, linkto);\n    }\n\n    constructor(name, type, length, persistent, linkto) {\n        this.name = name;\n        this.type = type;\n        this.length = length;\n        this.persistent = persistent;\n        this.linkto = linkto;\n        this.value = null;\n        this.listener = null;\n        return this;\n    }\n\n    getValue() {\n        //console.log(\"en get value: \" + this.value)\n        return this.value;\n    }\n\n    getSQLValue() {\n        //console.log(\"en get value: \" + this.value)\n        return this.value;\n    }\n\n    setValue(v) {\n        if (this.value != v) {\n            var oldvalue = this.value;\n            this.value = v;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n    toString(v) {\n        return this.value != null ? this.value.toString() : null;\n    }\n}\n\n//var DateField = Object.create(Field)\nclass DateField extends Field {\n    constructor(name, type, length, persistent, linkto) {\n        super(name, type, length, persistent, linkto)\n    }\n\n    setValue(v) {\n        var vv;\n        if (v == null) {\n            vv = null;\n        } else if (v instanceof moment) {\n            vv = v\n        } else if (v instanceof Date) {\n            vv = moment(v)\n        } else if (typeof v == 'string') {\n            vv = moment(v, \"YYYY-MM-DD\")\n        } else {\n            vv = null\n        }\n        if (this.value != vv) {\n            var oldvalue = this.value;\n            this.value = vv;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n\n    getSQLValue() {\n        return this.value == null ? null : this.value.format(\"YYYY-MM-DD\");\n    }\n}\n\n//var TimeField = Object.create(Field)\nclass TimeField extends Field {\n    constructor(name, type, length, persistent, linkto) {\n        super(name, type, length, persistent, linkto)\n    }\n\n    setValue(v) {\n        var vv;\n        if (v == null) {\n            vv = null;\n        } else if (v instanceof moment) {\n            vv = v.format(\"HH:mm:ss\")\n        } else if (typeof v == 'string') {\n            vv = v\n        } else {\n            vv = null\n        }\n        if (this.value != vv) {\n            var oldvalue = this.value;\n            this.value = vv;\n            if (this.listener) this.listener.fieldModified(this, oldvalue);\n        }\n    }\n\n    getSQLValue() {\n        return this.value == null ? null : this.value;\n    }\n}\n\n\n\nvar DetailField = Object.create(Array.prototype);\nDetailField.init = function(name, description, listener) {\n    this.name = name;\n    this.__description__ = description;\n    this.type = this.__description__.type\n    this.__rowclass__ = null;\n    this.__removed_rows__ = [];\n    this.listener = listener;\n    return this;\n}\n\nDetailField.getRowClass = function getRowClass() {\n    if (this.__rowclass__ == null) this.__rowclass__ = oo.classmanager.getClass(this.__description__.class);\n    return this.__rowclass__;\n}\n\nDetailField.clearRemovedRows = function clearRemovedRows() {\n    this.__removed_rows__ = [];\n}\n\nDetailField.fieldNames = function fieldNames() {\n    return this.getRowClass().fieldNames();\n}\nDetailField.newRow = function newRow() {\n    return this.getRowClass().new();\n}\n\nDetailField.push = function push(obj) {\n    obj.rowNr = this.length;\n    Array.prototype.push.call(this, obj)\n    obj.addListener(this);\n    if (this.listener) this.listener.rowInserted(this, obj, this.length-1);\n}\n\nDetailField.insert = function insert(obj, pos) {\n    //return this.push(obj)\n    obj.rowNr = pos;\n    Array.prototype.splice.call(this, pos, 0, obj)\n    for (var i=pos+1;i<this.length;i++) {\n        this[i].rowNr = i;\n    }\n    obj.addListener(this);\n    if (this.listener) this.listener.rowInserted(this, obj, pos);\n}\n\nDetailField.clear = function clear() {\n    if (this.length != 0) {\n        this.length = 0;\n        if (this.listener) this.listener.detailCleared(this);\n    }\n}\n\nDetailField.splice = function splice() {\n    var self = this;\n    var removed = Array.prototype.splice.apply(this, arguments)\n    removed.forEach(function (element) {self.__removed_rows__.push(element)});\n    if (removed.length >0) {\n        for (var i=removed[0].rowNr; i<self.length; i++) {\n            self[i].rowNr = i;\n        }\n        if (this.listener) this.listener.fieldModified(this);\n    }\n    return removed;\n}\n\nDetailField.fieldModified = function fieldModified(record, field, oldvalue) {\n    //[].unshift.call(arguments, this);\n    if (this.listener) this.listener.fieldModified.call(this.listener, this, record, field, oldvalue)\n}\n\nvar RecordListener = Object.create(null);\nRecordListener.init = function (fieldModified) {\n    this.fieldModified = fieldModified;\n    return this;\n}\n\nvar FieldsListener = Object.create(null);\nFieldsListener.receiver = null;\nFieldsListener.fieldModified = function () {\n    if (this.receiver != null) this.receiver.fieldModified.apply(this.receiver, arguments);\n}\n\nFieldsListener.rowInserted = function (detail, row, position) {\n    if (this.receiver != null) this.receiver.rowInserted(detail, row, position)\n}\n\nFieldsListener.detailCleared = function (detail, row, position) {\n    if (this.receiver != null) this.receiver.detailCleared(detail)\n}\n\nvar RecordDescription = {\n    name: 'Embedded_Record',\n    inherits: null,\n    fields: {\n        internalId: {type: \"integer\"},\n    },\n    fieldnames: ['internalId'],\n    detailnames: []\n}\n\nvar Embedded_Record = Object.create({\n    '__super__': null,\n    '__description__': RecordDescription,\n    '__filename__': __filename,\n})\n\nEmbedded_Record.new = function () {\n    var res = Object.create(this);\n    res.__class__ = this;\n    return res.init();\n}\n\nfunction propFieldGetter(fn)\n{\n    return function () {\n        //console.log(\"getting \" + fn + \" : \" + this.__fields__[fn].getValue())\n        return this.__fields__[fn].getValue()\n    }\n}\n\nfunction propFieldSetter(fn){\n    return function (v) {\n        //console.log(\"setting  \"+  v + \" in \" + fn);\n        return this.__fields__[fn].setValue(v);\n    }\n}\n\nfunction propDetailGetter(fn)\n{\n    return function () {\n        //console.log(\"getting \" + fn + \" : \" + this.__fields__[fn].getValue())\n        return this.__details__[fn]\n    }\n}\n\nEmbedded_Record.createChildClass = function createChildClass(descriptor, filename) {\n    var childclass = Object.create(this)\n    childclass.__description__ = {fields: {}}\n    for (var fn in this.__description__.fields) {\n        childclass.__description__.fields[fn] = this.__description__.fields[fn];\n    }\n    for (var fn in descriptor.fields) {\n        childclass.__description__.fields[fn] = descriptor.fields[fn];\n    }\n    childclass.__description__.name = descriptor.name;\n    childclass.__description__.fieldnames = _(Object.keys(childclass.__description__.fields)).filter(function (fn) {return childclass.__description__.fields[fn].type != 'detail'})\n    childclass.__description__.detailnames =_(Object.keys(childclass.__description__.fields)).filter(function (fn) {return childclass.__description__.fields[fn].type == 'detail'})\n    childclass.__filename__ = filename;\n    childclass.__super__ = this;\n    return childclass;\n}\n\nEmbedded_Record.super = function callSuper(methodname, self) {\n    if (methodname in this.__super__) {\n        return this.__super__[methodname].apply(self, Array.prototype.slice.apply(arguments).slice(2));\n    } else {\n        return Promise.resolve();\n    }\n}\n\nEmbedded_Record.getDescription = function getDescription() {\n    return this.__description__\n}\n\nEmbedded_Record.init = function init() {\n    this.__isnew__ = true;\n    this.__ismodified__ = false;\n    this.__fields__ = {}\n    this.__oldfields__ = {}\n    this.__details__ = {}\n    this.__fieldslistener__ = Object.create(FieldsListener)\n    this.__fieldslistener__.receiver = this;\n    var props = {}\n    this.__listeners__ = [];\n    this.load = this.load.bind(this)\n    this.store = this.store.bind(this)\n    this.save = this.save.bind(this)\n    this.delete = this.delete.bind(this)\n    for (var fn in this.__description__.fields) {\n        var fd = this.__description__.fields[fn]\n        if (fd.type != 'detail') {\n            this.__oldfields__[fn] = Field.create(fn, fd.type, fd.length, fd.persistent, fd.linkto);\n            this.__fields__[fn] = Field.create(fn, fd.type, fd.length, fd.persistent, fd.linkto);\n            this.__fields__[fn].listener = this.__fieldslistener__;\n            props[fn] = {\n                enumerable: true,\n                get: propFieldGetter(fn),\n                set: propFieldSetter(fn),\n            }\n        } else {\n            this.__details__[fn] = Object.create(DetailField).init(fn, fd, this.__fieldslistener__);\n            props[fn] = {\n                enumerable: true,\n                get: propDetailGetter(fn),\n            }\n        }\n    }\n    Object.defineProperties(this, props)\n    return this;\n}\n\nEmbedded_Record.fieldModified = function(p1, p2, p3, p4) { //it could be: {p1: field} or {p1: detail, p2: row, p3: rowfield, p4: oldvalue}\n    this.setModifiedFlag(true);\n    //[].unshift.call(arguments, this);\n    for (var i=0;i<this.__listeners__.length;i++) {\n        this.__listeners__[i].fieldModified.call(this.__listeners__[i], this, p1, p2 , p3, p4);\n    }\n}\n\nEmbedded_Record.rowInserted = function rowInserted(detail, row, position) { //it could be: {p1: field} or {p1: detail, p2: row, p3: rowfield}\n    this.setModifiedFlag(true);\n    for (var i=0;i<this.__listeners__.length;i++) {\n        this.__listeners__[i].rowInserted(this, detail, row , position);\n    }\n}\n\nEmbedded_Record.detailCleared = function detailCleared(detail) {  //{p1: detail}\n    this.setModifiedFlag(true);\n    for (var i=0;i<this.__listeners__.length;i++) {\n        this.__listeners__[i].detailCleared(this, detail);\n    }\n}\n\n\nEmbedded_Record.addListener = function (listener) {\n    this.__listeners__.push(listener);\n}\n\nEmbedded_Record.fieldNames = function fieldNames() {return this.__description__.fieldnames}\nEmbedded_Record.detailNames = function detailNames() {return this.__description__.detailnames}\nEmbedded_Record.fields = function fields(fn) {return this.__fields__[fn]}\nEmbedded_Record.oldFields = function oldFields(fn) {return this.__oldfields__[fn]}\nEmbedded_Record.details = function details(dn) {return this.__details__[dn]}\nEmbedded_Record.hasField = function hasField(fn) {return fn in this.__fields__}\nEmbedded_Record.inspect = function inspect() {\n    return \"<\" + this.__description__.name + \", from \" + this.__filename__+ \">\"\n}\n\nEmbedded_Record.__clearRemovedRows__XX = function __clearRemovedRows__() {\n    _(this.__details__).map(function (detail) { detail._removed_rows__ = []})\n}\n\nEmbedded_Record.save = async function save() {\n    let self = this;\n    let was_new = null;\n    let res = await self.check()\n    if (!res) return res;\n    if (self.isNew()) {\n        was_new = true;\n        res = await self.beforeInsert();\n        if (!res) return res;\n    } else {\n        was_new = false;\n        res = self.beforeUpdate();\n        if (!res) return res;\n    }\n    res = await self.store();\n    if (!res) return res;\n    if (was_new) {\n        self.afterInsert();\n    } else {\n        self.afterUpdate();\n    }\n    return true;\n}\n\nEmbedded_Record.syncOldFields = function syncOldFields() {\n    var self = this;\n    var fields = this.__description__.fields;\n    _(this.__description__.fields).forEach(function (fdef, fn) {\n        if (fdef.type != 'detail') {\n            self.oldFields(fn).setValue(self[fn])\n        } else {\n            var detail = self[fn]\n            for (var j=0;j<detail.length;j++) {\n                detail[j].syncOldFields();\n            }\n            detail.clearRemovedRows();\n        }\n    })\n    self.setModifiedFlag(false)\n}\n\nEmbedded_Record.defaults = function defaults() {\n    return Promise.resolve();\n}\n\nEmbedded_Record.check = function check() {\n    //return Promise.reject(\"check failed\")\n    return Promise.resolve();\n}\n\nEmbedded_Record.beforeInsert = function beforeInsert() {\n    return Promise.resolve();\n}\n\nEmbedded_Record.beforeUpdate = function beforeUpdate() {\n    return Promise.resolve();\n}\n\nEmbedded_Record.afterInsert = function afterInsert() {\n    return Promise.resolve();\n}\n\nEmbedded_Record.afterUpdate = function afterUpdate() {\n    return Promise.resolve();\n}\n\nEmbedded_Record.store = async function store() {\n    var res = await oo.orm.store(this);\n    return res\n}\n\nEmbedded_Record.delete = function del() {\n    return oo.orm.delete(this);\n}\n\nEmbedded_Record.load = function load() {\n    return oo.orm.load(this);\n}\n\nEmbedded_Record.select = function select() {\n    return Query.select(this)\n    //return oo.orm.select(this)\n}\n\nEmbedded_Record.isNew = function isNew() {\n    return this.__isnew__;\n}\n\nEmbedded_Record.setNewFlag = function setNewFlag(b) {\n    return this.__isnew__ = b;\n}\n\nEmbedded_Record.isModified = function isModified() {\n    return this.__ismodified__;\n}\n\nEmbedded_Record.setModifiedFlag = function setModifiedFlag(b) {\n    this.__ismodified__ = b;\n}\n\nEmbedded_Record.setNewFlag = function setNewFlag(b) {\n    return this.__isnew__ = b;\n}\n\nEmbedded_Record.toJSON = function toJSON() {\n    var obj = {\n        __meta__: {\n            __isnew__: this.__isnew__,\n            __ismodified__: this.__ismodified__,\n            __classname__: this.__description__.name\n        },\n        fields: {},\n        oldFields: {},\n        removedRows: {}\n    }\n    var fieldnames = this.fieldNames();\n    for (var i=0;i<fieldnames.length;i++) {\n        var fn = fieldnames[i];\n        obj.fields[fn] = this.fields(fn).getSQLValue();\n        obj.oldFields[fn] = this.oldFields(fn).getSQLValue();\n    }\n    var detailnames = this.detailNames();\n    for (var i=0;i<detailnames.length;i++) {\n        var dn = detailnames[i];\n        obj.fields[dn] = [];\n        var detail = this[dn];\n        for (var j=0;j<detail.length;j++) {\n            obj.fields[dn].push(this[dn][j].toJSON())\n        }\n        obj.removedRows[dn] = []\n        for (var j=0;j<detail.__removed_rows__.length;j++) {\n            obj.removedRows[dn].push(detail.__removed_rows__[j].toJSON())\n        }\n    }\n    return obj;\n}\n\nEmbedded_Record.fromJSON = function fromJSON(obj, rec) {\n    if (typeof obj == \"string\") obj = JSON.parse(obj);\n    if (rec == null) rec = oo.classmanager.getClass(obj.__meta__.__classname__).new();\n    var fieldnames = rec.fieldNames();\n    for (var i=0;i<fieldnames.length;i++) {\n        var fn = fieldnames[i];\n        rec[fn] = obj.fields[fn]\n        rec.oldFields(fn).setValue(obj.oldFields[fn])\n    }\n    var detailnames = rec.detailNames();\n    for (var i=0;i<detailnames.length;i++) {\n        var dn = detailnames[i];\n        var detail = rec[dn];\n        detail.clear();\n        for (var j=0;j<obj.fields[dn].length;j++) {\n            detail.push(detail.getRowClass().fromJSON(obj.fields[dn][j]))\n        }\n        for (var j=0;j<obj.removedRows[dn].length;j++) {\n            detail.__removed_rows__.push(detail.getRowClass().fromJSON(obj.removedRows[dn][j]))\n        }\n    }\n    rec.setNewFlag(obj.__meta__.__isnew__)\n    rec.setModifiedFlag(obj.__meta__.__ismodified__)\n    return rec;\n}\n\nEmbedded_Record.clone = function clone() {\n    var newrec = this.new();\n    var fieldnames = this.fieldNames();\n    for (var i=0;i<fieldnames.length;i++) {\n        var fn = fieldnames[i];\n        newrec[fn] = this[fn]\n    }\n    var detailnames = this.detailNames();\n    for (var i=0;i<detailnames.length;i++) {\n        var dn = detailnames[i];\n        var newdetail = newrec[dn];\n        var thisdetail = this[dn];\n        newdetail.clear();\n        for (var j=0;j<this[dn].length;j++) {\n            newdetail.push(thisdetail[j].clone())\n        }\n    }\n    newrec.setNewFlag(this.isNew())\n    newrec.setModifiedFlag(this.isModified())\n    return newrec;\n}\n\nEmbedded_Record.isEqual = function isEqual(rec) {\n    if (rec.prototype != this.prototype) return false;\n    var fieldnames = this.fieldNames();\n    for (var i=0;i<fieldnames.length;i++) {\n        var fn = fieldnames[i];\n        if (rec[fn] != this[fn]) return false;\n    }\n    var detailnames = this.detailNames();\n    for (var i=0;i<detailnames.length;i++) {\n        var dn = detailnames[i];\n        var recdetail = rec[dn];\n        var thisdetail = this[dn];\n        if (recdetail.length != thisdetail.length) return false;\n        for (var j=0;j<this[dn].length;j++) {\n            if (!recdetail[j].isEqual(thisdetail[j])) return false;\n        }\n    }\n    if (rec.isNew() != this.isNew()) return false;\n    if (rec.isModified() != this.isModified()) return false;\n    if (JSON.stringify(rec.toJSON()) != JSON.stringify(this.toJSON())) return false; //ojo con estoooooo es muy pesado me parece... y ademas es redundante, solo aporta la comparacion de oldfields y removedrows\n    return true;\n}\n\nEmbedded_Record.fieldIsEditable = function fieldIsEditable(fieldname, rowfieldname, rownr) {\n    if (rowfieldname == 'rowNr') return false;\n    return true;\n}\n\nmodule.exports = Embedded_Record\n"]}