{"version":3,"sources":["classmanager.js"],"names":[],"mappings":"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","file":"classmanager-compiled.js","sourcesContent":["\"use strict\";\n\nvar path = require(\"path\");\nvar fs = require(\"fs\")\n\nvar classmanager = Object.create(null);\n\nclassmanager.scriptdirs = [\"core\", \"base\"];\nclassmanager.reversed_scriptdirs = classmanager.scriptdirs.reverse()\n\nclassmanager.lookupdirs = [\"records\"];\n\nclassmanager.getClassFilename = function getClassFilename(name, max_script_dir_index) {\n    var ms = max_script_dir_index;\n    if (ms == null) ms = 0;\n    for (var i=ms; i<classmanager.reversed_scriptdirs.length; i++) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        for (var j in classmanager.lookupdirs) {\n            var ld = classmanager.lookupdirs[j];\n            var fn = \"./\" + sd + \"/\" + ld + \"/\" + name + \".js\";\n            if (fs.existsSync(fn)) return fn;\n        }\n    }\n    return null;\n}\n\nclassmanager.createClass = function createClass(description, filename) {\n    var ParentClass = classmanager.getParentClassFor(description.name, description.inherits, filename);\n    //console.log(ParentClass)\n    var ChildClass = ParentClass.createChildClass(description, filename);\n    return ChildClass;\n}\n\nclassmanager.getClass = function getClass(name, max_script_dir_index) {\n    //console.log(\"en getClass: \" + name)\n    var ms = max_script_dir_index;\n    if (ms == null) ms = 0;\n    for (var i=ms; i<classmanager.reversed_scriptdirs.length; i++) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        for (var j in classmanager.lookupdirs) {\n            var ld = classmanager.lookupdirs[j];\n            var modname = \"./\" + sd + \"/\" + ld + \"/\" + name;\n            try {\n                var r = global.__main__.require(modname);\n                //console.log([\"require: ./\" + sd + \"/\" + ld + \"/\" + name, r])\n                return r;\n            } catch (e) {\n                //console.log(\"mod not found\")\n                //console.log(e.message)\n                //console.log(\"Cannot find module '\" + modname + \"'\")\n                //console.log(e.message == \"Cannot find module '\" + modname + \"'\")\n                if (e.code != 'MODULE_NOT_FOUND' || e.message != \"Cannot find module '\" + modname + \"'\") throw(e)\n            }\n        }\n    }\n    //console.log(\"returning null class\")\n    return null;\n};\n\nclassmanager.extractScriptDir = function extractScriptDir(classpath) {\n    for (var i in classmanager.reversed_scriptdirs) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        var idx = classpath.lastIndexOf(\"/\"+sd+\"/\")\n        if (idx >= 0) {\n            return sd;\n        }\n    }\n    return null;\n}\n\nclassmanager.getParentClassFor = function getSuperClassFor(name, parent, classpath) {\n    var sd = classmanager.extractScriptDir(classpath)\n    var cls = classmanager.getClass(name, classmanager.reversed_scriptdirs.indexOf(sd)+1)\n    //console.log([name, parent, dirname, sd, composer.reversed_scriptdirs.indexOf(sd)+1, cls]);\n    if (cls != null) return cls;\n    var cls = classmanager.getClass(parent);\n    //console.log([name,parent,sd, \"returning: \" + cls.new().__description__.name])\n    return cls;\n};\n\nmodule.exports = classmanager;"]}