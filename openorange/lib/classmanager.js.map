{"version":3,"sources":["classmanager.es6"],"names":[],"mappings":"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","file":"classmanager.js","sourcesContent":["\"use strict\";\n\nvar path = require(\"path\");\nvar fs = require(\"fs\")\n\nvar classmanager = Object.create(null);\n\nclassmanager.createClassStructure = function loadClassStructure() {\n    let classStructure = []\n\n    function readFolderSync(sd, lookupdir, sdstruct) {\n        var folder = path.join(\"./\", sd, lookupdir);\n        try {\n            let files = fs.readdirSync(folder)\n            for (let i = 0; i < files.length; i++) {\n                let filename = files[i];\n                if (filename.endsWith(\".js\")) sdstruct[lookupdir][path.basename(filename, \".js\")] = 1;\n            }\n        } catch (err) {\n            if (err.code !== 'ENOENT') throw err;\n        }\n    }\n\n    for (let i = 0; i < this.reversed_scriptdirs.length; i++) {\n        var sd = this.reversed_scriptdirs[i];\n        let sdstruct = {sd: sd}\n        let lookupdirs = this.lookupdirs;\n        for (let j = 0; j < lookupdirs.length; j++) {\n            let lookupdir = lookupdirs[j];\n            sdstruct[lookupdir] = {}\n            readFolderSync(sd, lookupdir, sdstruct)\n        }\n        classStructure.push(sdstruct);\n    }\n    return classStructure;\n}\n\nclassmanager.init = function init() {\n    this.__class_structure__ = this.createClassStructure();\n    return this;\n}\n\nclassmanager.scriptdirs = []\nclassmanager.reversed_scriptdirs = []\nclassmanager.addScriptDir = function addScriptDir(sd) {\n    classmanager.scriptdirs.push(sd)\n    classmanager.reversed_scriptdirs = Array.prototype.slice.call(classmanager.scriptdirs).reverse()\n}\n\nclassmanager.addScriptDir(\"core\");\nclassmanager.addScriptDir(\"base\");\nclassmanager.addScriptDir(\"standard\");\nclassmanager.addScriptDir(\"test\")\nclassmanager.lookupdirs = [\"records\", \"windows\", \"reports\", \"modules\", \"tools\", \"documents\"];\n\nclassmanager.getClassFilename = function getClassFilename(name, min_script_dir_index) {\n    var ms = min_script_dir_index;\n    if (ms == null) ms = 0;\n    for (var i = ms; i < classmanager.reversed_scriptdirs.length; i++) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        for (var j in classmanager.lookupdirs) {\n            var ld = classmanager.lookupdirs[j];\n            var fn = \"./\" + sd + \"/\" + ld + \"/\" + name + \".js\";\n            if (fs.existsSync(fn)) return fn;\n        }\n    }\n    return null;\n}\n\nclassmanager.createClass = function createClass(description, filename) {\n    var ParentClass = classmanager.getParentClassFor(description.name, description.inherits, filename);\n    var ChildClass = ParentClass.createChildClass(description, filename);\n    return ChildClass;\n}\n\nclassmanager.getClassStructure = function getClassStructur() {\n    return this.__class_structure__;\n}\n\nclassmanager.getClass = function getClass(name, options) {\n    let opts = options || {min_sd: 0, max_sd: classmanager.reversed_scriptdirs.length-1};\n    var min_sd = 'min_sd' in opts? opts.min_sd : 0;\n    var max_sd = 'max_sd' in opts? opts.max_sd : classmanager.reversed_scriptdirs.length-1;\n    if (min_sd >= classmanager.reversed_scriptdirs.length) return null;\n    for (let i = min_sd; i <= max_sd; i++) {\n        var sd = this.reversed_scriptdirs[i];\n        for (let j = 0; j < this.lookupdirs.length; j++) {\n            let ld = this.lookupdirs[j]\n            if (name in this.__class_structure__[i][ld]) {\n                let modname = \"./\" + sd + \"/\" + ld + \"/\" + name;\n                let r = global.__main__.require(modname);\n                return r;\n            }\n        }\n    }\n    return null;\n}\n\n\n/*\n classmanager.getClass = function getClass(name, max_script_dir_index) {\n //console.log(\"en getClass: \" + name)\n var ms = max_script_dir_index;\n if (ms == null) ms = 0;\n for (var i = ms; i < classmanager.reversed_scriptdirs.length; i++) {\n var sd = classmanager.reversed_scriptdirs[i];\n for (var j in classmanager.lookupdirs) {\n var ld = classmanager.lookupdirs[j];\n var modname = \"./\" + sd + \"/\" + ld + \"/\" + name;\n try {\n //console.log(\"requiring: \" + modname)\n var r = global.__main__.require(modname);\n //console.log(`found ${name} in ${modname}`)\n return r;\n } catch (e) {\n //console.log(\"ESTOY ACA\", e.code, e.message, (e.code != 'MODULE_NOT_FOUND' || e.message != \"Cannot find module '\" + modname + \"'\"))\n if (e.code != 'MODULE_NOT_FOUND' || e.message != \"Cannot find module '\" + modname + \"'\") {\n console.log(\"Error requiring module: \" + modname);\n console.log(e.stack);\n console.log(e.message);\n throw(e)\n }\n }\n }\n }\n //console.log(\"returning null class\")\n return null;\n };\n */\n\nclassmanager.extractScriptDir = function extractScriptDir(classpath) {\n    for (var i in classmanager.reversed_scriptdirs) {\n        var sd = classmanager.reversed_scriptdirs[i];\n        var idx = classpath.lastIndexOf(\"/\" + sd + \"/\")\n        if (idx >= 0) {\n            return sd;\n        }\n    }\n    return null;\n}\n\nclassmanager.getParentClassFor = function getParentClassFor(name, parent, classpath) {\n    if (!name || !parent || !classpath) {\n        if (!name) throw new Error(\"can't find a parent class without a name\")\n        if (!parent) throw new Error(\"can't find a parent class without a inherit attrbute\")\n        if (!classpath) throw new Error(\"can't find a parent class without a path\")\n    }\n    var sd = classmanager.extractScriptDir(classpath)\n\n    var cls = classmanager.getClass(name, {min_sd: classmanager.reversed_scriptdirs.indexOf(sd) + 1})\n    if (cls != null) return cls;\n    var cls = classmanager.getClass(parent);\n    return cls;\n};\n\nclassmanager.SuperClass = function SuperClass(description) {\n    let superclass = classmanager.getParentClassFor(description.name, description.inherits, description.filename)\n    //superclass = superclass.prepareParentClass(description, classpath)\n    return superclass\n};\n\nmodule.exports = classmanager;"]}