{"version":3,"sources":["openorange.es6"],"names":[],"mappings":"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","file":"openorange.js","sourcesContent":["\"use strict\";\n\n(function ($) {\n    let classmanager = {};\n    let orm = {};\n    let __currentUser__ = null;\n    classmanager.scriptdirs = [\"core\", \"base\", \"standard\", \"test\"];\n    classmanager.reversed_scriptdirs = Array.prototype.slice.call(classmanager.scriptdirs).reverse()\n    classmanager.extractScriptDir = function extractScriptDir(dirname) {\n        for (var i in classmanager.reversed_scriptdirs) {\n            var sd = classmanager.reversed_scriptdirs[i];\n            var idx = dirname.lastIndexOf(\"/\" + sd + \"/\")\n            if (idx >= 0) {\n                return sd;\n            }\n        }\n        return null;\n    }\n\n    classmanager.createClass = function createClass(description, filename) {\n        var ParentClass = classmanager.getParentClassFor(description.name, description.inherits, filename);\n        var ChildClass = ParentClass.createChildClass(description, filename);\n        return ChildClass;\n    }\n\n\n\n    let require = function require(module) {\n        if (module == \"openorange\") return window.oo; //devuelvo window.oo porque ese objeto va a haber si extendido por windowmanager, listiwndowmanger, etc, etc, etc.\n        if (module == \"underscore\") return _;\n        if (module == \"moment\") return moment;\n        if (module == \"chance\") return Chance;\n        if (module == \"js-md5\") return md5;\n        return loadModule(module)\n    }\n\n    function global() {\n    }\n\n    global.__main__ = {require: require}\n    require.main = {require: require}\n\n    classmanager.classes = {}\n    classmanager.getClass = function getClass(name, max_script_dir_index) {\n        if (max_script_dir_index == null) max_script_dir_index = 0;\n        var k = name + \"|\" + max_script_dir_index;\n        if (k in classmanager.classes) {\n            //console.log(\"getclass: returning \" + name + \" from cache\");\n            return classmanager.classes[k]\n        }\n        //console.log(\"getclass: fetching \" + name + \" from server\");\n        var url = '/runtime/class';\n        var res = null;\n        $.ajax({\n            url: url,\n            dataType: \"script\",\n            data: {name: name, max_script_dir_index: max_script_dir_index},\n            async: false,\n            success: function (result) {\n                //console.log(\"en success: \" + name);\n                res = moduleFunction();\n                classmanager.classes[k] = res;\n                //if (!max_script_dir_index) classmanager.classes[name] = res;\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                //console.log(\"en fail\")\n                console.log(errorThrown)\n                throw errorThrown;\n            },\n            complete: function () {\n                //console.log(\"en getclass::complete\");\n            }\n        });\n        return res;\n    }\n\n    classmanager.SuperClass = function SuperClass(description) {\n        return classmanager.getParentClassFor(description.name, description.inherits, description.filename);\n    }\n\n    classmanager.getParentClassFor = function getParentClassFor(name, parent, dirname) {\n        var k = name + \"|\" + parent + \"|\" + dirname;\n        if (k in classmanager.classes) {\n            //console.log(\"getparentclass: returning \" + name + \" from cache\");\n            return classmanager.classes[k];\n        }\n        var url = '/runtime/parentclass';\n        var res = null;\n        $.ajax({\n            url: url,\n            dataType: \"script\",\n            async: false,\n            data: {name: name, parent: parent, dirname: dirname},\n            success: function (result) {\n                res = moduleFunction();\n                //console.log(\"en parent success: \" + name +\"/\" + parent + \"   \" + res.__filename__);\n                classmanager.classes[k] = res;\n                //console.log(\"getparentclass: fetching \" + name + \"/\" + parent + \"/\" + dirname + \" from server\");\n                //console.log(res)\n                if (res.__description__.name != name) {\n                    //console.log(\"storing as: \" + res.__description__.name + \" and \" + res.__description__.name + \"|0\");\n                    classmanager.classes[res.__description__.name + \"|0\"] = res;\n                }\n                var sd_idx = classmanager.reversed_scriptdirs.indexOf(classmanager.extractScriptDir(res.__description__.filename));\n                if (sd_idx != 0) {\n                    classmanager.classes[res.__description__.name + \"|\" + sd_idx] = res;\n                }\n\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                if (textStatus == 'parsererror') {\n                    //evaluo el codigo que para vuelva a saltar el error y aparezca en el debugger\n                    eval(jqXHR.responseText)\n                }\n                console.log(errorThrown)\n                throw errorThrown;\n            },\n            complete: function () {\n                //console.log(\"en getparentclass::complete\");\n            }\n        });\n        return res;\n    }\n\n    let loadedModules = {}\n    let loadModule = function loadModule(url) {\n        if (url in loadedModules) {\n            //console.log(\"getparentclass: returning \" + name + \" from cache\");\n            return loadedModules[url];\n        }\n        var res = null;\n        $.ajax({\n            url: 'runtime/module',\n            dataType: \"script\",\n            data: {url: url},\n            async: false,\n            success: function (result) {\n                //console.log(\"en success: \" + name);\n                res = moduleFunction();\n                loadedModules[url] = res;\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                //console.log(\"en fail\")\n                console.log(errorThrown)\n                throw errorThrown;\n            },\n            complete: function () {\n                //console.log(\"en getclass::complete\");\n            }\n        });\n        return res;\n    }\n\n    $(document).ready(function () {\n        var oo = require(\"openorange\")\n        $('#OOSearch.typeahead').typeahead({hint: true}, {\n            async: true,\n            display: 'label',\n            limit: 4,\n            source: function (query, syncResults, asyncResults) {\n\n                //syncResults([])\n                oo.explorer.search(query)\n                    .then(function (results) {\n                        //console.log(results.length)\n                        asyncResults(results)\n\n                    })\n\n            },\n        }).on('typeahead:selected', function (obj, datum) {\n            var wnd = null;\n            switch (datum.type) {\n                case 'Record Class':\n                    wnd = oo.classmanager.getClass(datum.access).new();\n                    break;\n                case 'Report':\n                    wnd = oo.classmanager.getClass(datum.name).new();\n                    break;\n            }\n            if (wnd != null) {\n                wnd.open()\n                wnd.setFocus()\n            }\n\n        });\n        $('span.twitter-typeahead').attr('style', '').removeClass(\"twitter-typeahead\")\n    })\n\n    let login = function (user, pass) {\n        let password = pass || '';\n        $.ajax({\n            url: '/runtime/login',\n            contentType: 'application/json; charset=utf-8',\n            async: true,\n            type: \"POST\",\n            dataType: \"json\",\n            data: JSON.stringify({username: user, md5pass: md5(password)}),\n            success: function (result) {\n                if (result.ok == true) {\n                    __currentUser__ = user;\n                } else {\n                    console.log(result.error)\n                }\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                console.log(errorThrown)\n                throw errorThrown;\n            },\n            complete: function () {\n            }\n        });\n\n    }\n\n    let rollback = function rollback() {\n        return new Promise(function (resolve, reject) {\n            var url = '/runtime/oo/rollback';\n            $.ajax({\n                type: \"POST\",\n                url: url,\n                contentType: 'application/json; charset=utf-8',\n                dataType: \"json\",\n                async: true,\n                //data: JSON.stringify(data),\n                success: function (result) {\n                    if (!result.ok) {\n                        reject(result.error);\n                        return;\n                    }\n                    var response = 'response' in result ? result.response : null;\n                    resolve(response);\n                    return;\n                },\n                error: function (jqXHR, textStatus, errorThrown) {\n                    //console.log(\"en fail\")\n                    reject(errorThrown);\n                },\n                complete: function () {\n                    //console.log(\"en load::complete\");\n                }\n            });\n        });\n    }\n\n    let beginTransaction = function beginTransaction() {\n        return new Promise(function (resolve, reject) {\n            var url = '/runtime/oo/begintransaction';\n            $.ajax({\n                type: \"POST\",\n                url: url,\n                contentType: 'application/json; charset=utf-8',\n                dataType: \"json\",\n                async: true,\n                //data: JSON.stringify(data),\n                success: function (result) {\n                    if (!result.ok) {\n                        reject(result.error);\n                        return;\n                    }\n                    var response = 'response' in result ? result.response : null;\n                    resolve(response);\n                    return;\n                },\n                error: function (jqXHR, textStatus, errorThrown) {\n                    //console.log(\"en fail\")\n                    reject(errorThrown);\n                },\n                complete: function () {\n                    //console.log(\"en load::complete\");\n                }\n            });\n        });\n    }\n\n    let commit = function commit() {\n        return new Promise(function (resolve, reject) {\n            var url = '/runtime/oo/commit';\n            $.ajax({\n                type: \"POST\",\n                url: url,\n                contentType: 'application/json; charset=utf-8',\n                dataType: \"json\",\n                async: true,\n                //data: JSON.stringify(data),\n                success: function (result) {\n                    if (!result.ok) {\n                        reject(result.error);\n                        return;\n                    }\n                    var response = 'response' in result ? result.response : null;\n                    resolve(response);\n                    return;\n                },\n                error: function (jqXHR, textStatus, errorThrown) {\n                    //console.log(\"en fail\")\n                    reject(errorThrown);\n                },\n                complete: function () {\n                    //console.log(\"en load::complete\");\n                }\n            });\n        });\n    }\n\n    let currentUser = function currentUser() {\n        return __currentUser__\n    }\n\n    let fetchCurrentUser = async function fetchCurrentUser() {\n        return new Promise(function (resolve, reject) {\n            $.ajax({\n                type: \"GET\",\n                url: '/runtime/getcurrentuser',\n                contentType: 'application/json; charset=utf-8',\n                dataType: \"json\",\n                async: true,\n                success: function (result) {\n                    if (!result.ok) {\n                        reject(result.error);\n                        return;\n                    }\n                    var response = 'response' in result ? result.response : null;\n                    __currentUser__ = result.currentuser;\n                    resolve(result.currentuser);\n                    return;\n                },\n                error: function (jqXHR, textStatus, errorThrown) {\n                    reject(errorThrown);\n                },\n                complete: function () {\n                    //console.log(\"en load::complete\");\n                }\n            });\n        });\n    }\n\n\n\n    let oo = {\n        ui: {},\n        classmanager: classmanager,\n        orm: orm,\n        isServer: false,\n        isClient: true,\n        login: login,\n        beginTransaction: beginTransaction,\n        rollback: rollback,\n        commit: commit,\n        currentUser: currentUser,\n        md5: md5\n        //ready: ready,\n    }\n\n    fetchCurrentUser();\n    //window.require = require\n\n    $.extend(true, window, {require: require, oo: oo})\n})(jQuery)"]}