{"version":3,"sources":["explorer.es6"],"names":[],"mappings":"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","file":"explorer.js","sourcesContent":["\"use strict\";\n\n\nvar cm = null;\nfunction getClassManager() {\n    if (cm == null) cm = require(\"openorange\").classmanager;\n    return cm\n}\n\nvar Explorer = Object.create(null)\n\nExplorer.search__server = async function search(txt) {\n    var self = this;\n    var res = []\n    var regexp = new RegExp(txt, \"i\");\n    let modules = await self.findAllModules();\n    for (let modname in modules) {\n        if (modname == 'ALL') continue //por ahora\n        var module = modules[modname];\n        for (let j=0;j<module.records.length; j++) {\n            var entry = module.records[j];\n            if (entry.label.search(regexp) >= 0) res.push({type: 'Record Class', name:entry.name, label: entry.label, access: entry.access})\n        }\n        for (let j=0;j<module.reports.length; j++) {\n            var entry = module.reports[j];\n            if (entry.label.search(regexp) >= 0) res.push({type: 'Report', name:entry.name, label: entry.label, access: entry.access})\n        }\n    }\n    return res;\n}\n\nExplorer.search__client = function search(txt) {\n    var self = this;\n    return new Promise(function (resolve, reject) {\n        var url = require('openorange').baseurl + '/explorer/search';\n        $.ajax({\n            type: \"GET\",\n            url: url,\n            contentType: 'application/json; charset=utf-8',\n            async: true,\n            data: {txt: txt},\n            success: function (result) {\n                if (!result.ok) {\n                    reject(result.error);\n                    return;\n                }\n                resolve(result.response);\n                return;\n            },\n            error: function (jqXHR, textStatus, errorThrown) {\n                //console.log(\"en fail\")\n                reject(errorThrown);\n            },\n            complete: function () {\n                //console.log(\"en load::complete\");\n            }\n        });\n    });\n}\n\n\n\nExplorer.findAllModules = function findAllModules() {\n    var Promise = require(\"bluebird\");\n    var fs = require(\"fs\");\n    var path = require(\"path\")\n    var res = {ALL: {records: {}, windows: {}, documents: {}, reports: {}, routines: {}, tools: {}}};\n    function searchFolder(sd, lookupdir) {\n        var folder = \"./\" + sd + \"/\" + lookupdir;\n        let promise = Promise.pending();\n        fs.readdir(folder, function (err, files)  {\n            if (err) {\n                promise.resolve();\n                return;\n            };\n            if (lookupdir == 'modules') {\n                for (let i=0;i<files.length;i++) {\n                    let filename = files[i];\n                    if (!filename.endsWith(\".js\")) continue;\n                    var cname = path.parse(filename).name;\n                    if (!(cname in res)) res[cname] = cm.getClass(cname).getDescription();\n                }\n            } else {\n                for (let i=0;i<files.length;i++) {\n                    let filename = files[i];\n                    if (!filename.endsWith(\".js\")) continue;\n                    var cname = path.parse(filename).name;\n                    if (!(cname in res.ALL[lookupdir])) res.ALL[lookupdir][cname] = cname;\n                }\n            }\n            promise.resolve();\n        });\n        return promise.promise;\n    }\n\n    let promise = Promise.pending();\n\n    let promises = []\n    for (let i=0; i<getClassManager().reversed_scriptdirs.length; i++) {\n        var sd = getClassManager().reversed_scriptdirs[i];\n        let lookupdirs = getClassManager().lookupdirs;\n        for (let j = 0;j<lookupdirs.length;j++) {\n            let lookupdir = lookupdirs[j];\n            var prom = searchFolder(sd, lookupdir)\n            promises.push(prom)\n        }\n    }\n    Promise.all(promises).then(function () {\n        res.ALL.records = Object.keys(res.ALL.records)\n        res.ALL.windows = Object.keys(res.ALL.windows)\n        res.ALL.reports = Object.keys(res.ALL.reports)\n        res.ALL.documents = Object.keys(res.ALL.documents)\n        res.ALL.routines = Object.keys(res.ALL.routines)\n        res.ALL.tools = Object.keys(res.ALL.tools)\n        promise.resolve(res)\n    })\n    return promise.promise;\n}\n\nif (typeof window == 'undefined') {\n    Explorer.search = Explorer.search__server;\n    module.exports = Explorer\n} else {\n    Explorer.search = Explorer.search__client\n    $.extend(true, window.oo, {explorer: Explorer})\n}\n"]}