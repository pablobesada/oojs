{"version":3,"sources":["../../node_modules/openorange/lib/serverquery.es6"],"names":[],"mappings":"AAAA;;;;;;AAEA,IAAI,YAAY,QAAQ,aAAR,CAAhB;AACA,IAAI,KAAK,QAAQ,MAAR,CAAT;AACA,IAAI,WAAW,QAAQ,YAAR,CAAf;AACA,IAAI,KAAK,QAAQ,gBAAR,CAAT;AACA,IAAI,MAAM,QAAQ,kBAAR,CAAV;;AAEA,IAAI,cAAc,OAAO,MAAP,CAAc,SAAd,CAAlB;;AAGA,YAAY,KAAZ;AAAA,wDAAoB;AAAA,YAEZ,IAFY,EAGZ,GAHY,EAMZ,IANY,eASX,IATW,EASL,MATK,EAWZ,MAXY,EAmBP,CAnBO,EAaR,MAbQ;;AAAA;AAAA;AAAA;AAAA;;AAEZ,4BAFY,GAEL,IAFK;AAGZ,2BAHY,GAGN,KAAK,WAAL,EAHM;;;;AAAA;AAAA,+BAMC,IAAI,eAAJ,EAND;;AAAA;AAMZ,4BANY;AAAA;AAAA,+BASW,KAAK,KAAL,CAAW,IAAI,GAAf,EAAoB,IAAI,MAAxB,CATX;;AAAA;AAAA;AAAA;AASX,4BATW;AASL,8BATK;;;AAWZ,8BAXY,GAWH,EAXG;;AAYhB,6BAAS,CAAT,GAAW,CAAX,EAAa,IAAE,KAAK,MAApB,EAA2B,GAA3B,EAAgC;AACxB,kCADwB,GACf,KAAK,YAAL,CAAkB,GAAlB,EADe;;AAE5B,qCAAS,6BAAT,CAAuC,MAAvC,EAA+C,KAAK,CAAL,CAA/C,EAAwD,MAAxD;AACA,mCAAO,UAAP,CAAkB,KAAlB;AACA,mCAAO,eAAP,CAAuB,KAAvB;AACA,mCAAO,IAAP,CAAY,MAAZ;AACH;AACD,6BAAS,CAAT,GAAW,CAAX,EAAa,IAAE,OAAO,MAAtB,EAA6B,GAA7B,EAAkC;AAC9B,mCAAO,CAAP,EAAU,aAAV;AACH;AArBe,yDAsBT,MAtBS;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAApB;;AAAA,aAAmC,KAAnC;AAAA;AAAA;;AAAA,WAAmC,KAAnC;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA,YAAY,QAAZ,GAAuB,SAAS,QAAT,CAAkB,GAAlB,EAAuB;AAC1C,QAAI,QAAQ,OAAO,MAAP,CAAc,IAAd,CAAZ;AACA,UAAM,KAAN,GAAc,IAAI,KAAlB;AACA,UAAM,UAAN,GAAmB,IAAI,UAAvB;AACA,UAAM,YAAN,GAAqB,GAAG,QAAH,CAAY,IAAI,gBAAhB,CAArB;AACA,UAAM,WAAN,GAAoB,IAAI,WAAxB;AACA,UAAM,MAAN,GAAe,IAAI,MAAnB;AACA,UAAM,QAAN,GAAiB,IAAI,QAArB;AACA,UAAM,MAAN,GAAe,IAAI,MAAnB;AACA,UAAM,OAAN,GAAgB,IAAI,OAApB;AACA,WAAO,KAAP;AACH,CAXD;;AAaA,OAAO,OAAP,GAAiB,WAAjB","file":"serverquery.js","sourcesContent":["\"use strict\";\n\nvar BaseQuery = require(\"./basequery\")\nvar db = require(\"./db\")\nvar ormutils = require(\"./ormutils\")\nvar cm = require(\"./classmanager\")\nvar ctx = require(\"./contextmanager\")\n\nvar ServerQuery = Object.create(BaseQuery)\n\n\nServerQuery.fetch = async function fetch() {\n    //console.log(\"quering\")\n    var self = this;\n    var sql = this.generateSQL()\n    //var conn = null;\n    //var conn = await db.getConnection()\n    var conn = await ctx.getDBConnection()\n    //var qres = await conn.query(sql.sql, sql.values);\n    //var rows = qres[0], fields = qres[1];\n    var [rows, fields] = await conn.query(sql.sql, sql.values);\n    //var qres = await conn.query(sql.sql, sql.values);\n    var result = [];\n    for (var i=0;i<rows.length;i++) {\n        var record = self._recordClass.new();\n        ormutils.fill_record_with_query_result(record, rows[i], fields)\n        record.setNewFlag(false);\n        record.setModifiedFlag(false);\n        result.push(record);\n    }\n    for (var i=0;i<result.length;i++) {\n        result[i].syncOldFields();\n    }\n    return result;\n}\n\n/*\nServerQuery.fetch = function fetch() {\n    var self = this;\n    var sql = this.generateSQL()\n    var conn = null;\n    return db.getConnection()\n        .then(function (newconn) {\n            conn = newconn;\n            console.log(sql.sql)\n            return conn.query(sql.sql, sql.values)\n        })\n        .spread(function (rows, fields) {\n            var result = [];\n            for (var i=0;i<rows.length;i++) {\n                var record = self._recordClass.new();\n                ormutils.fill_record_with_query_result(record, rows[i], fields)\n                record.setNewFlag(false);\n                record.setModifiedFlag(false);\n                result.push(record);\n            }\n            return result;\n        })\n        .then(function (result) {\n            for (var i=0;i<result.length;i++) {\n                result[i].syncOldFields();\n            }\n            return result;\n        })\n}*/\n\n\nServerQuery.fromJSON = function fromJSON(obj) {\n    var query = Object.create(this)\n    query._type = obj._type;\n    query._fromtable = obj._fromtable\n    query._recordClass = cm.getClass(obj._recordClassName)\n    query._projection = obj._projection\n    query._where = obj._where\n    query._orderby = obj._orderby\n    query._limit = obj._limit\n    query._offset = obj._offset\n    return query;\n}\n\nmodule.exports = ServerQuery"]}