{"version":3,"sources":["runnable.js"],"names":[],"mappings":";;;;AAIA,IAAI,eAAe,QAAQ,QAAR,EAAkB,YAArC;AACA,IAAI,UAAU,QAAQ,WAAR,CAAd;AACA,IAAI,QAAQ,QAAQ,OAAR,EAAiB,gBAAjB,CAAZ;AACA,IAAI,eAAe,QAAQ,MAAR,CAAnB;AACA,IAAI,QAAQ,QAAQ,SAAR,CAAZ;AACA,IAAI,WAAW,MAAM,QAArB;;;;;;;AAOA,IAAI,OAAO,OAAO,IAAlB;AACA,IAAI,aAAa,OAAO,UAAxB;AACA,IAAI,cAAc,OAAO,WAAzB;AACA,IAAI,eAAe,OAAO,YAA1B;AACA,IAAI,gBAAgB,OAAO,aAA3B;;;;;;;AAOA,IAAI,WAAW,OAAO,SAAP,CAAiB,QAAhC;;;;;;AAMA,OAAO,OAAP,GAAiB,QAAjB;;;;;;;;;;;AAWA,SAAS,QAAT,CAAkB,KAAlB,EAAyB,EAAzB,EAA6B;AAC3B,OAAK,KAAL,GAAa,KAAb;AACA,OAAK,EAAL,GAAU,EAAV;AACA,OAAK,KAAL,GAAa,MAAM,GAAG,MAAtB;AACA,OAAK,IAAL,GAAY,CAAC,KAAK,KAAlB;AACA,OAAK,QAAL,GAAgB,IAAhB;AACA,OAAK,KAAL,GAAa,EAAb;AACA,OAAK,eAAL,GAAuB,IAAvB;AACA,OAAK,QAAL,GAAgB,KAAhB;AACA,OAAK,MAAL,GAAc,IAAI,KAAJ,CAAU,8BAAV,CAAd;AACA,OAAK,QAAL,GAAgB,CAAC,CAAjB;AACA,OAAK,aAAL,GAAqB,CAArB;AACD;;;;;AAKD,SAAS,QAAT,EAAmB,YAAnB;;;;;;;;;AASA,SAAS,SAAT,CAAmB,OAAnB,GAA6B,UAAS,EAAT,EAAa;AACxC,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,QAAZ;AACD;AACD,MAAI,OAAO,CAAX,EAAc;AACZ,SAAK,eAAL,GAAuB,KAAvB;AACD;AACD,MAAI,OAAO,EAAP,KAAc,QAAlB,EAA4B;AAC1B,SAAK,aAAa,EAAb,CAAL;AACD;AACD,QAAM,YAAN,EAAoB,EAApB;AACA,OAAK,QAAL,GAAgB,EAAhB;AACA,MAAI,KAAK,KAAT,EAAgB;AACd,SAAK,YAAL;AACD;AACD,SAAO,IAAP;AACD,CAhBD;;;;;;;;;AAyBA,SAAS,SAAT,CAAmB,IAAnB,GAA0B,UAAS,EAAT,EAAa;AACrC,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,KAAZ;AACD;AACD,MAAI,OAAO,EAAP,KAAc,QAAlB,EAA4B;AAC1B,SAAK,aAAa,EAAb,CAAL;AACD;AACD,QAAM,YAAN,EAAoB,EAApB;AACA,OAAK,KAAL,GAAa,EAAb;AACA,SAAO,IAAP;AACD,CAVD;;;;;;;;;AAmBA,SAAS,SAAT,CAAmB,cAAnB,GAAoC,UAAS,OAAT,EAAkB;AACpD,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,eAAZ;AACD;AACD,QAAM,mBAAN,EAA2B,OAA3B;AACA,OAAK,eAAL,GAAuB,OAAvB;AACA,SAAO,IAAP;AACD,CAPD;;;;;;;AAcA,SAAS,SAAT,CAAmB,IAAnB,GAA0B,YAAW;AACnC,QAAM,IAAI,OAAJ,EAAN;AACD,CAFD;;;;;;;AASA,SAAS,SAAT,CAAmB,OAAnB,GAA6B,UAAS,CAAT,EAAY;AACvC,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,QAAZ;AACD;AACD,OAAK,QAAL,GAAgB,CAAhB;AACD,CALD;;;;;;;AAYA,SAAS,SAAT,CAAmB,YAAnB,GAAkC,UAAS,CAAT,EAAY;AAC5C,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,aAAZ;AACD;AACD,OAAK,aAAL,GAAqB,CAArB;AACD,CALD;;;;;;;;;AAcA,SAAS,SAAT,CAAmB,SAAnB,GAA+B,YAAW;AACxC,SAAO,KAAK,MAAL,CAAY,SAAZ,KAA0B,GAA1B,GAAgC,KAAK,KAA5C;AACD,CAFD;;;;;;;AASA,SAAS,SAAT,CAAmB,YAAnB,GAAkC,YAAW;AAC3C,eAAa,KAAK,KAAlB;AACD,CAFD;;;;;;;;AAUA,SAAS,SAAT,CAAmB,OAAnB,GAA6B,YAAW;AACtC,SAAO,KAAK,SAAL,CAAe,IAAf,EAAqB,UAAS,GAAT,EAAc,GAAd,EAAmB;AAC7C,QAAI,IAAI,CAAJ,MAAW,GAAf,EAAoB;AAClB;AACD;AACD,QAAI,QAAQ,QAAZ,EAAsB;AACpB,aAAO,UAAP;AACD;AACD,QAAI,QAAQ,KAAZ,EAAmB;AACjB,aAAO,YAAP;AACD;AACD,WAAO,GAAP;AACD,GAXM,EAWJ,CAXI,CAAP;AAYD,CAbD;;;;;;;AAoBA,SAAS,SAAT,CAAmB,YAAnB,GAAkC,YAAW;AAC3C,MAAI,OAAO,IAAX;AACA,MAAI,KAAK,KAAK,OAAL,MAAkB,GAA3B;;AAEA,MAAI,CAAC,KAAK,eAAV,EAA2B;AACzB;AACD;AACD,OAAK,YAAL;AACA,OAAK,KAAL,GAAa,WAAW,YAAW;AACjC,QAAI,CAAC,KAAK,eAAV,EAA2B;AACzB;AACD;AACD,SAAK,QAAL,CAAc,IAAI,KAAJ,CAAU,gBAAgB,EAAhB,GAAqB,uEAA/B,CAAd;AACA,SAAK,QAAL,GAAgB,IAAhB;AACD,GANY,EAMV,EANU,CAAb;AAOD,CAfD;;;;;;;;AAuBA,SAAS,SAAT,CAAmB,OAAnB,GAA6B,UAAS,OAAT,EAAkB;AAC7C,MAAI,CAAC,UAAU,MAAf,EAAuB;AACrB,WAAO,KAAK,eAAZ;AACD;AACD,OAAK,eAAL,GAAuB,OAAvB;AACD,CALD;;;;;;;;AAaA,SAAS,SAAT,CAAmB,GAAnB,GAAyB,UAAS,EAAT,EAAa;AACpC,MAAI,OAAO,IAAX;AACA,MAAI,QAAQ,IAAI,IAAJ,EAAZ;AACA,MAAI,MAAM,KAAK,GAAf;AACA,MAAI,QAAJ;AACA,MAAI,OAAJ;;;AAGA,MAAI,OAAO,IAAI,QAAf,EAAyB;AACvB,QAAI,QAAJ,CAAa,IAAb;AACD;;;AAGD,WAAS,QAAT,CAAkB,GAAlB,EAAuB;AACrB,QAAI,OAAJ,EAAa;AACX;AACD;AACD,cAAU,IAAV;AACA,SAAK,IAAL,CAAU,OAAV,EAAmB,OAAO,IAAI,KAAJ,CAAU,4DAAV,CAA1B;AACD;;;AAGD,WAAS,IAAT,CAAc,GAAd,EAAmB;AACjB,QAAI,KAAK,KAAK,OAAL,EAAT;AACA,QAAI,KAAK,QAAT,EAAmB;AACjB;AACD;AACD,QAAI,QAAJ,EAAc;AACZ,aAAO,SAAS,OAAO,KAAK,MAArB,CAAP;AACD;;AAED,SAAK,YAAL;AACA,SAAK,QAAL,GAAgB,IAAI,IAAJ,KAAa,KAA7B;AACA,eAAW,IAAX;AACA,QAAI,CAAC,GAAD,IAAQ,KAAK,QAAL,GAAgB,EAAxB,IAA8B,KAAK,eAAvC,EAAwD;AACtD,YAAM,IAAI,KAAJ,CAAU,gBAAgB,EAAhB,GAAqB,uEAA/B,CAAN;AACD;AACD,OAAG,GAAH;AACD;;;AAGD,OAAK,QAAL,GAAgB,IAAhB;;;AAGA,MAAI,KAAK,KAAT,EAAgB;AACd,SAAK,YAAL;;AAEA,QAAI,KAAK,aAAT,EAAwB;AACtB,aAAO,YAAY,KAAK,EAAjB,CAAP;AACD;AACD,QAAI;AACF,kBAAY,KAAK,EAAjB;AACD,KAFD,CAEE,OAAO,GAAP,EAAY;AACZ,WAAK,MAAM,QAAN,CAAe,GAAf,CAAL;AACD;AACD;AACD;;AAED,MAAI,KAAK,aAAT,EAAwB;AACtB,WAAO,KAAK,EAAZ;AACA;AACA;AACD;;;AAGD,MAAI;AACF,QAAI,KAAK,OAAT,EAAkB;AAChB;AACD,KAFD,MAEO;AACL,aAAO,KAAK,EAAZ;AACD;AACF,GAND,CAME,OAAO,GAAP,EAAY;AACZ,SAAK,MAAM,QAAN,CAAe,GAAf,CAAL;AACD;;AAED,WAAS,MAAT,CAAgB,EAAhB,EAAoB;AAClB,QAAI,SAAS,GAAG,IAAH,CAAQ,GAAR,CAAb;AACA,QAAI,UAAU,OAAO,OAAO,IAAd,KAAuB,UAArC,EAAiD;AAC/C,WAAK,YAAL;AACA,aACG,IADH,CACQ,YAAW;AACf;;;AAGA,eAAO,IAAP;AACD,OANH,EAOE,UAAS,MAAT,EAAiB;AACf,aAAK,UAAU,IAAI,KAAJ,CAAU,0CAAV,CAAf;AACD,OATH;AAUD,KAZD,MAYO;AACL,UAAI,KAAK,SAAT,EAAoB;AAClB,eAAO,KAAK,IAAI,KAAJ,CAAU,8EAAV,CAAL,CAAP;AACD;;AAED;AACD;AACF;;AAED,WAAS,WAAT,CAAqB,EAArB,EAAyB;AACvB,OAAG,IAAH,CAAQ,GAAR,EAAa,UAAS,GAAT,EAAc;AACzB,UAAI,eAAe,KAAf,IAAwB,SAAS,IAAT,CAAc,GAAd,MAAuB,gBAAnD,EAAqE;AACnE,eAAO,KAAK,GAAL,CAAP;AACD;AACD,UAAI,GAAJ,EAAS;AACP,YAAI,OAAO,SAAP,CAAiB,QAAjB,CAA0B,IAA1B,CAA+B,GAA/B,MAAwC,iBAA5C,EAA+D;AAC7D,iBAAO,KAAK,IAAI,KAAJ,CAAU,oCAClB,KAAK,SAAL,CAAe,GAAf,CADQ,CAAL,CAAP;AAED;AACD,eAAO,KAAK,IAAI,KAAJ,CAAU,oCAAoC,GAA9C,CAAL,CAAP;AACD;AACD;AACD,KAZD;AAaD;AACF,CAjHD","file":"runnable-compiled.js","sourcesContent":["/**\n * Module dependencies.\n */\n\nvar EventEmitter = require('events').EventEmitter;\nvar Pending = require('./pending');\nvar debug = require('debug')('mocha:runnable');\nvar milliseconds = require('./ms');\nvar utils = require('./utils');\nvar inherits = utils.inherits;\n\n/**\n * Save timer references to avoid Sinon interfering (see GH-237).\n */\n\n/* eslint-disable no-unused-vars, no-native-reassign */\nvar Date = global.Date;\nvar setTimeout = global.setTimeout;\nvar setInterval = global.setInterval;\nvar clearTimeout = global.clearTimeout;\nvar clearInterval = global.clearInterval;\n/* eslint-enable no-unused-vars, no-native-reassign */\n\n/**\n * Object#toString().\n */\n\nvar toString = Object.prototype.toString;\n\n/**\n * Expose `Runnable`.\n */\n\nmodule.exports = Runnable;\n\n/**\n * Initialize a new `Runnable` with the given `title` and callback `fn`.\n *\n * @param {String} title\n * @param {Function} fn\n * @api private\n * @param {string} title\n * @param {Function} fn\n */\nfunction Runnable(title, fn) {\n  this.title = title;\n  this.fn = fn;\n  this.async = fn && fn.length;\n  this.sync = !this.async;\n  this._timeout = 2000;\n  this._slow = 75;\n  this._enableTimeouts = true;\n  this.timedOut = false;\n  this._trace = new Error('done() called multiple times');\n  this._retries = -1;\n  this._currentRetry = 0;\n}\n\n/**\n * Inherit from `EventEmitter.prototype`.\n */\ninherits(Runnable, EventEmitter);\n\n/**\n * Set & get timeout `ms`.\n *\n * @api private\n * @param {number|string} ms\n * @return {Runnable|number} ms or Runnable instance.\n */\nRunnable.prototype.timeout = function(ms) {\n  if (!arguments.length) {\n    return this._timeout;\n  }\n  if (ms === 0) {\n    this._enableTimeouts = false;\n  }\n  if (typeof ms === 'string') {\n    ms = milliseconds(ms);\n  }\n  debug('timeout %d', ms);\n  this._timeout = ms;\n  if (this.timer) {\n    this.resetTimeout();\n  }\n  return this;\n};\n\n/**\n * Set & get slow `ms`.\n *\n * @api private\n * @param {number|string} ms\n * @return {Runnable|number} ms or Runnable instance.\n */\nRunnable.prototype.slow = function(ms) {\n  if (!arguments.length) {\n    return this._slow;\n  }\n  if (typeof ms === 'string') {\n    ms = milliseconds(ms);\n  }\n  debug('timeout %d', ms);\n  this._slow = ms;\n  return this;\n};\n\n/**\n * Set and get whether timeout is `enabled`.\n *\n * @api private\n * @param {boolean} enabled\n * @return {Runnable|boolean} enabled or Runnable instance.\n */\nRunnable.prototype.enableTimeouts = function(enabled) {\n  if (!arguments.length) {\n    return this._enableTimeouts;\n  }\n  debug('enableTimeouts %s', enabled);\n  this._enableTimeouts = enabled;\n  return this;\n};\n\n/**\n * Halt and mark as pending.\n *\n * @api private\n */\nRunnable.prototype.skip = function() {\n  throw new Pending();\n};\n\n/**\n * Set number of retries.\n *\n * @api private\n */\nRunnable.prototype.retries = function(n) {\n  if (!arguments.length) {\n    return this._retries;\n  }\n  this._retries = n;\n};\n\n/**\n * Get current retry\n *\n * @api private\n */\nRunnable.prototype.currentRetry = function(n) {\n  if (!arguments.length) {\n    return this._currentRetry;\n  }\n  this._currentRetry = n;\n};\n\n/**\n * Return the full title generated by recursively concatenating the parent's\n * full title.\n *\n * @api public\n * @return {string}\n */\nRunnable.prototype.fullTitle = function() {\n  return this.parent.fullTitle() + ' ' + this.title;\n};\n\n/**\n * Clear the timeout.\n *\n * @api private\n */\nRunnable.prototype.clearTimeout = function() {\n  clearTimeout(this.timer);\n};\n\n/**\n * Inspect the runnable void of private properties.\n *\n * @api private\n * @return {string}\n */\nRunnable.prototype.inspect = function() {\n  return JSON.stringify(this, function(key, val) {\n    if (key[0] === '_') {\n      return;\n    }\n    if (key === 'parent') {\n      return '#<Suite>';\n    }\n    if (key === 'ctx') {\n      return '#<Context>';\n    }\n    return val;\n  }, 2);\n};\n\n/**\n * Reset the timeout.\n *\n * @api private\n */\nRunnable.prototype.resetTimeout = function() {\n  var self = this;\n  var ms = this.timeout() || 1e9;\n\n  if (!this._enableTimeouts) {\n    return;\n  }\n  this.clearTimeout();\n  this.timer = setTimeout(function() {\n    if (!self._enableTimeouts) {\n      return;\n    }\n    self.callback(new Error('timeout of ' + ms + 'ms exceeded. Ensure the done() callback is being called in this test.'));\n    self.timedOut = true;\n  }, ms);\n};\n\n/**\n * Whitelist a list of globals for this test run.\n *\n * @api private\n * @param {string[]} globals\n */\nRunnable.prototype.globals = function(globals) {\n  if (!arguments.length) {\n    return this._allowedGlobals;\n  }\n  this._allowedGlobals = globals;\n};\n\n/**\n * Run the test and invoke `fn(err)`.\n *\n * @param {Function} fn\n * @api private\n */\nRunnable.prototype.run = function(fn) {\n  var self = this;\n  var start = new Date();\n  var ctx = this.ctx;\n  var finished;\n  var emitted;\n\n  // Sometimes the ctx exists, but it is not runnable\n  if (ctx && ctx.runnable) {\n    ctx.runnable(this);\n  }\n\n  // called multiple times\n  function multiple(err) {\n    if (emitted) {\n      return;\n    }\n    emitted = true;\n    self.emit('error', err || new Error('done() called multiple times; stacktrace may be inaccurate'));\n  }\n\n  // finished\n  function done(err) {\n    var ms = self.timeout();\n    if (self.timedOut) {\n      return;\n    }\n    if (finished) {\n      return multiple(err || self._trace);\n    }\n\n    self.clearTimeout();\n    self.duration = new Date() - start;\n    finished = true;\n    if (!err && self.duration > ms && self._enableTimeouts) {\n      err = new Error('timeout of ' + ms + 'ms exceeded. Ensure the done() callback is being called in this test.');\n    }\n    fn(err);\n  }\n\n  // for .resetTimeout()\n  this.callback = done;\n\n  // explicit async with `done` argument\n  if (this.async) {\n    this.resetTimeout();\n\n    if (this.allowUncaught) {\n      return callFnAsync(this.fn);\n    }\n    try {\n      callFnAsync(this.fn);\n    } catch (err) {\n      done(utils.getError(err));\n    }\n    return;\n  }\n\n  if (this.allowUncaught) {\n    callFn(this.fn);\n    done();\n    return;\n  }\n\n  // sync or promise-returning\n  try {\n    if (this.pending) {\n      done();\n    } else {\n      callFn(this.fn);\n    }\n  } catch (err) {\n    done(utils.getError(err));\n  }\n\n  function callFn(fn) {\n    var result = fn.call(ctx);\n    if (result && typeof result.then === 'function') {\n      self.resetTimeout();\n      result\n        .then(function() {\n          done();\n          // Return null so libraries like bluebird do not warn about\n          // subsequently constructed Promises.\n          return null;\n        },\n        function(reason) {\n          done(reason || new Error('Promise rejected with no or falsy reason'));\n        });\n    } else {\n      if (self.asyncOnly) {\n        return done(new Error('--async-only option in use without declaring `done()` or returning a promise'));\n      }\n\n      done();\n    }\n  }\n\n  function callFnAsync(fn) {\n    fn.call(ctx, function(err) {\n      if (err instanceof Error || toString.call(err) === '[object Error]') {\n        return done(err);\n      }\n      if (err) {\n        if (Object.prototype.toString.call(err) === '[object Object]') {\n          return done(new Error('done() invoked with non-Error: '\n            + JSON.stringify(err)));\n        }\n        return done(new Error('done() invoked with non-Error: ' + err));\n      }\n      done();\n    });\n  }\n};\n"]}