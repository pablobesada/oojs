{"version":3,"sources":["Parser.js"],"names":[],"mappings":"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","file":"Parser-compiled.js","sourcesContent":["var MAX_PACKET_LENGTH = Math.pow(2, 24) - 1;\nvar MUL_32BIT         = Math.pow(2, 32);\nvar PacketHeader      = require('./PacketHeader');\nvar BigNumber         = require('bignumber.js');\n\nmodule.exports = Parser;\nfunction Parser(options) {\n  options = options || {};\n\n  this._supportBigNumbers = options.config && options.config.supportBigNumbers;\n  this._buffer            = new Buffer(0);\n  this._longPacketBuffers = [];\n  this._offset            = 0;\n  this._packetEnd         = null;\n  this._packetHeader      = null;\n  this._packetOffset      = null;\n  this._onError           = options.onError || function(err) { throw err; };\n  this._onPacket          = options.onPacket || function() {};\n  this._nextPacketNumber  = 0;\n  this._encoding          = 'utf-8';\n  this._paused            = false;\n}\n\nParser.prototype.write = function(buffer) {\n  this.append(buffer);\n\n  while (!this._paused) {\n    if (!this._packetHeader) {\n      if (this._bytesRemaining() < 4) {\n        break;\n      }\n\n      this._packetHeader = new PacketHeader(\n        this.parseUnsignedNumber(3),\n        this.parseUnsignedNumber(1)\n      );\n\n      if (this._packetHeader.number !== this._nextPacketNumber) {\n        var err = new Error(\n          'Packets out of order. Got: ' + this._packetHeader.number + ' ' +\n          'Expected: ' + this._nextPacketNumber\n        );\n\n        err.code  = 'PROTOCOL_PACKETS_OUT_OF_ORDER';\n        err.fatal = true;\n\n        this._onError(err);\n      }\n\n      this.incrementPacketNumber();\n    }\n\n    if (this._bytesRemaining() < this._packetHeader.length) {\n      break;\n    }\n\n    this._packetEnd    = this._offset + this._packetHeader.length;\n    this._packetOffset = this._offset;\n\n    if (this._packetHeader.length === MAX_PACKET_LENGTH) {\n      this._longPacketBuffers.push(this._buffer.slice(this._packetOffset, this._packetEnd));\n\n      this._advanceToNextPacket();\n      continue;\n    }\n\n    this._combineLongPacketBuffers();\n\n    // Try...finally to ensure exception safety. Unfortunately this is costing\n    // us up to ~10% performance in some benchmarks.\n    var hadException = true;\n    try {\n      this._onPacket(this._packetHeader);\n      hadException = false;\n    } catch (err) {\n      if (!err || typeof err.code !== 'string' || err.code.substr(0, 7) !== 'PARSER_') {\n        throw err; // Rethrow non-MySQL errors\n      }\n\n      // Pass down parser errors\n      this._onError(err);\n      hadException = false;\n    } finally {\n      this._advanceToNextPacket();\n\n      // If we had an exception, the parser while loop will be broken out\n      // of after the finally block. So we need to make sure to re-enter it\n      // to continue parsing any bytes that may already have been received.\n      if (hadException) {\n        process.nextTick(this.write.bind(this));\n      }\n    }\n  }\n};\n\nParser.prototype.append = function append(chunk) {\n  if (!chunk || chunk.length === 0) {\n    return;\n  }\n\n  var buffer      = chunk;\n  var sliceEnd    = this._buffer.length;\n  var sliceStart  = this._packetOffset === null\n    ? this._offset\n    : this._packetOffset;\n  var sliceLength = sliceEnd - sliceStart;\n\n  if (sliceLength !== 0) {\n    // Create a new Buffer\n    buffer = new Buffer(sliceLength + chunk.length);\n\n    // Copy data\n    this._buffer.copy(buffer, 0, sliceStart, sliceEnd);\n    chunk.copy(buffer, sliceLength);\n  }\n\n  // Adjust data-tracking pointers\n  this._buffer       = buffer;\n  this._offset       = this._offset - sliceStart;\n  this._packetEnd    = this._packetEnd !== null\n    ? this._packetEnd - sliceStart\n    : null;\n  this._packetOffset = this._packetOffset !== null\n    ? this._packetOffset - sliceStart\n    : null;\n};\n\nParser.prototype.pause = function() {\n  this._paused = true;\n};\n\nParser.prototype.resume = function() {\n  this._paused = false;\n\n  // nextTick() to avoid entering write() multiple times within the same stack\n  // which would cause problems as write manipulates the state of the object.\n  process.nextTick(this.write.bind(this));\n};\n\nParser.prototype.peak = function() {\n  return this._buffer[this._offset];\n};\n\nParser.prototype.parseUnsignedNumber = function(bytes) {\n  if (bytes === 1) {\n    return this._buffer[this._offset++];\n  }\n\n  var buffer = this._buffer;\n  var offset = this._offset + bytes - 1;\n  var value  = 0;\n\n  if (bytes > 4) {\n    var err    = new Error('parseUnsignedNumber: Supports only up to 4 bytes');\n    err.offset = (this._offset - this._packetOffset - 1);\n    err.code   = 'PARSER_UNSIGNED_TOO_LONG';\n    throw err;\n  }\n\n  while (offset >= this._offset) {\n    value = ((value << 8) | buffer[offset]) >>> 0;\n    offset--;\n  }\n\n  this._offset += bytes;\n\n  return value;\n};\n\nParser.prototype.parseLengthCodedString = function() {\n  var length = this.parseLengthCodedNumber();\n\n  if (length === null) {\n    return null;\n  }\n\n  return this.parseString(length);\n};\n\nParser.prototype.parseLengthCodedBuffer = function() {\n  var length = this.parseLengthCodedNumber();\n\n  if (length === null) {\n    return null;\n  }\n\n  return this.parseBuffer(length);\n};\n\nParser.prototype.parseLengthCodedNumber = function parseLengthCodedNumber() {\n  if (this._offset >= this._buffer.length) {\n    var err    = new Error('Parser: read past end');\n    err.offset = (this._offset - this._packetOffset);\n    err.code   = 'PARSER_READ_PAST_END';\n    throw err;\n  }\n\n  var bits = this._buffer[this._offset++];\n\n  if (bits <= 250) {\n    return bits;\n  }\n\n  switch (bits) {\n    case 251:\n      return null;\n    case 252:\n      return this.parseUnsignedNumber(2);\n    case 253:\n      return this.parseUnsignedNumber(3);\n    case 254:\n      break;\n    default:\n      var err    = new Error('Unexpected first byte' + (bits ? ': 0x' + bits.toString(16) : ''));\n      err.offset = (this._offset - this._packetOffset - 1);\n      err.code   = 'PARSER_BAD_LENGTH_BYTE';\n      throw err;\n  }\n\n  var low = this.parseUnsignedNumber(4);\n  var high = this.parseUnsignedNumber(4);\n  var value;\n\n  if (high >>> 21) {\n    value = (new BigNumber(low)).plus((new BigNumber(MUL_32BIT)).times(high)).toString();\n\n    if (this._supportBigNumbers) {\n      return value;\n    }\n\n    var err    = new Error(\n      'parseLengthCodedNumber: JS precision range exceeded, ' +\n      'number is >= 53 bit: \"' + value + '\"'\n    );\n    err.offset = (this._offset - this._packetOffset - 8);\n    err.code   = 'PARSER_JS_PRECISION_RANGE_EXCEEDED';\n    throw err;\n  }\n\n  value = low + (MUL_32BIT * high);\n\n  return value;\n};\n\nParser.prototype.parseFiller = function(length) {\n  return this.parseBuffer(length);\n};\n\nParser.prototype.parseNullTerminatedBuffer = function() {\n  var end      = this._nullByteOffset();\n  var value    = this._buffer.slice(this._offset, end);\n  this._offset = end + 1;\n\n  return value;\n};\n\nParser.prototype.parseNullTerminatedString = function() {\n  var end      = this._nullByteOffset();\n  var value    = this._buffer.toString(this._encoding, this._offset, end);\n  this._offset = end + 1;\n\n  return value;\n};\n\nParser.prototype._nullByteOffset = function() {\n  var offset = this._offset;\n\n  while (this._buffer[offset] !== 0x00) {\n    offset++;\n\n    if (offset >= this._buffer.length) {\n      var err    = new Error('Offset of null terminated string not found.');\n      err.offset = (this._offset - this._packetOffset);\n      err.code   = 'PARSER_MISSING_NULL_BYTE';\n      throw err;\n    }\n  }\n\n  return offset;\n};\n\nParser.prototype.parsePacketTerminatedString = function() {\n  var length = this._packetEnd - this._offset;\n  return this.parseString(length);\n};\n\nParser.prototype.parseBuffer = function(length) {\n  var response = new Buffer(length);\n  this._buffer.copy(response, 0, this._offset, this._offset + length);\n\n  this._offset += length;\n  return response;\n};\n\nParser.prototype.parseString = function(length) {\n  var offset = this._offset;\n  var end = offset + length;\n  var value = this._buffer.toString(this._encoding, offset, end);\n\n  this._offset = end;\n  return value;\n};\n\nParser.prototype.parseGeometryValue = function() {\n  var buffer = this.parseLengthCodedBuffer();\n  var offset = 4;\n\n  if (buffer === null || !buffer.length) {\n    return null;\n  }\n\n  function parseGeometry() {\n    var result = null;\n    var byteOrder = buffer.readUInt8(offset); offset += 1;\n    var wkbType = byteOrder? buffer.readUInt32LE(offset) : buffer.readUInt32BE(offset); offset += 4;\n    switch(wkbType) {\n      case 1: // WKBPoint\n        var x = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n        var y = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n        result = {x: x, y: y};\n        break;\n      case 2: // WKBLineString\n        var numPoints = byteOrder? buffer.readUInt32LE(offset) : buffer.readUInt32BE(offset); offset += 4;\n        result = [];\n        for(var i=numPoints;i>0;i--) {\n          var x = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n          var y = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n          result.push({x: x, y: y});\n        }\n        break;\n      case 3: // WKBPolygon\n        var numRings = byteOrder? buffer.readUInt32LE(offset) : buffer.readUInt32BE(offset); offset += 4;\n        result = [];\n        for(var i=numRings;i>0;i--) {\n          var numPoints = byteOrder? buffer.readUInt32LE(offset) : buffer.readUInt32BE(offset); offset += 4;\n          var line = [];\n          for(var j=numPoints;j>0;j--) {\n            var x = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n            var y = byteOrder? buffer.readDoubleLE(offset) : buffer.readDoubleBE(offset); offset += 8;\n            line.push({x: x, y: y});\n          }\n          result.push(line);\n        }\n        break;\n      case 4: // WKBMultiPoint\n      case 5: // WKBMultiLineString\n      case 6: // WKBMultiPolygon\n      case 7: // WKBGeometryCollection\n        var num = byteOrder? buffer.readUInt32LE(offset) : buffer.readUInt32BE(offset); offset += 4;\n        var result = [];\n        for(var i=num;i>0;i--) {\n          result.push(parseGeometry());\n        }\n        break;\n    }\n    return result;\n  }\n  return parseGeometry();\n};\n\nParser.prototype.reachedPacketEnd = function() {\n  return this._offset === this._packetEnd;\n};\n\nParser.prototype._bytesRemaining = function() {\n  return this._buffer.length - this._offset;\n};\n\nParser.prototype.incrementPacketNumber = function() {\n  var currentPacketNumber = this._nextPacketNumber;\n  this._nextPacketNumber = (this._nextPacketNumber + 1) % 256;\n\n  return currentPacketNumber;\n};\n\nParser.prototype.resetPacketNumber = function() {\n  this._nextPacketNumber = 0;\n};\n\nParser.prototype.packetLength = function() {\n  return this._longPacketBuffers.reduce(function(length, buffer) {\n    return length + buffer.length;\n  }, this._packetHeader.length);\n};\n\nParser.prototype._combineLongPacketBuffers = function() {\n  if (!this._longPacketBuffers.length) {\n    return;\n  }\n\n  var trailingPacketBytes = this._buffer.length - this._packetEnd;\n\n  var length = this._longPacketBuffers.reduce(function(length, buffer) {\n    return length + buffer.length;\n  }, this._bytesRemaining());\n\n  var combinedBuffer = new Buffer(length);\n\n  var offset = this._longPacketBuffers.reduce(function(offset, buffer) {\n    buffer.copy(combinedBuffer, offset);\n    return offset + buffer.length;\n  }, 0);\n\n  this._buffer.copy(combinedBuffer, offset, this._offset);\n\n  this._buffer            = combinedBuffer;\n  this._longPacketBuffers = [];\n  this._offset            = 0;\n  this._packetEnd         = this._buffer.length - trailingPacketBytes;\n  this._packetOffset      = 0;\n};\n\nParser.prototype._advanceToNextPacket = function() {\n  this._offset       = this._packetEnd;\n  this._packetHeader = null;\n  this._packetEnd    = null;\n  this._packetOffset = null;\n};\n"]}