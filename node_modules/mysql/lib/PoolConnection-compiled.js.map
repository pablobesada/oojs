{"version":3,"sources":["PoolConnection.js"],"names":[],"mappings":"AAAA,IAAI,WAAW,QAAQ,MAAR,EAAgB,QAA/B;AACA,IAAI,aAAa,QAAQ,cAAR,CAAjB;;AAEA,OAAO,OAAP,GAAiB,cAAjB;AACA,SAAS,cAAT,EAAyB,UAAzB;;AAEA,SAAS,cAAT,CAAwB,IAAxB,EAA8B,OAA9B,EAAuC;AACrC,aAAW,IAAX,CAAgB,IAAhB,EAAsB,OAAtB;AACA,OAAK,KAAL,GAAc,IAAd;;;;;AAKA,OAAK,EAAL,CAAQ,KAAR,EAAe,KAAK,eAApB;AACA,OAAK,EAAL,CAAQ,OAAR,EAAiB,UAAU,GAAV,EAAe;AAC9B,QAAI,IAAI,KAAR,EAAe;AACb,WAAK,eAAL;AACD;AACF,GAJD;AAKD;;AAED,eAAe,SAAf,CAAyB,OAAzB,GAAmC,SAAS,OAAT,GAAmB;AACpD,MAAI,OAAO,KAAK,KAAhB;AACA,MAAI,aAAa,IAAjB;;AAEA,MAAI,CAAC,IAAD,IAAS,KAAK,OAAlB,EAA2B;AACzB;AACD;;AAED,SAAO,KAAK,iBAAL,CAAuB,IAAvB,CAAP;AACD,CATD;;;AAYA,eAAe,SAAf,CAAyB,QAAzB,GAAoC,WAAW,SAAX,CAAqB,GAAzD;;AAEA,eAAe,SAAf,CAAyB,GAAzB,GAA+B,YAAY;AACzC,UAAQ,IAAR,CAAc,0DACA,yDADA,GAEA,+CAFA,GAGA,yBAHd;AAKA,OAAK,OAAL;AACD,CAPD;;AASA,eAAe,SAAf,CAAyB,OAAzB,GAAmC,YAAY;AAC7C,aAAW,SAAX,CAAqB,OAArB,CAA6B,KAA7B,CAAmC,IAAnC,EAAyC,SAAzC;AACA,OAAK,eAAL,CAAqB,IAArB;AACD,CAHD;;AAKA,eAAe,SAAf,CAAyB,eAAzB,GAA2C,SAAS,eAAT,GAA2B;AACpE,MAAI,CAAC,KAAK,KAAN,IAAe,KAAK,KAAL,CAAW,OAA9B,EAAuC;AACrC;AACD;;AAED,MAAI,OAAO,KAAK,KAAhB;AACA,OAAK,KAAL,GAAa,IAAb;;AAEA,OAAK,gBAAL,CAAsB,IAAtB;AACD,CATD","file":"PoolConnection-compiled.js","sourcesContent":["var inherits = require('util').inherits;\nvar Connection = require('./Connection');\n\nmodule.exports = PoolConnection;\ninherits(PoolConnection, Connection);\n\nfunction PoolConnection(pool, options) {\n  Connection.call(this, options);\n  this._pool  = pool;\n\n  // When a fatal error occurs the connection's protocol ends, which will cause\n  // the connection to end as well, thus we only need to watch for the end event\n  // and we will be notified of disconnects.\n  this.on('end', this._removeFromPool);\n  this.on('error', function (err) {\n    if (err.fatal) {\n      this._removeFromPool();\n    }\n  });\n}\n\nPoolConnection.prototype.release = function release() {\n  var pool = this._pool;\n  var connection = this;\n\n  if (!pool || pool._closed) {\n    return;\n  }\n\n  return pool.releaseConnection(this);\n};\n\n// TODO: Remove this when we are removing PoolConnection#end\nPoolConnection.prototype._realEnd = Connection.prototype.end;\n\nPoolConnection.prototype.end = function () {\n  console.warn( 'Calling conn.end() to release a pooled connection is '\n              + 'deprecated. In next version calling conn.end() will be '\n              + 'restored to default conn.end() behavior. Use '\n              + 'conn.release() instead.'\n              );\n  this.release();\n};\n\nPoolConnection.prototype.destroy = function () {\n  Connection.prototype.destroy.apply(this, arguments);\n  this._removeFromPool(this);\n};\n\nPoolConnection.prototype._removeFromPool = function _removeFromPool() {\n  if (!this._pool || this._pool._closed) {\n    return;\n  }\n\n  var pool = this._pool;\n  this._pool = null;\n\n  pool._purgeConnection(this);\n};\n"]}