{"version":3,"sources":["PoolNamespace.js"],"names":[],"mappings":"AAAA,IAAI,eAAe,QAAQ,gBAAR,CAAnB;;AAEA,OAAO,OAAP,GAAiB,aAAjB;;;;;AAKA,SAAS,aAAT,CAAuB,OAAvB,EAAgC,OAAhC,EAAyC,QAAzC,EAAmD;AACjD,OAAK,QAAL,GAAgB,OAAhB;AACA,OAAK,QAAL,GAAgB,OAAhB;AACA,OAAK,SAAL,GAAiB,IAAI,aAAa,QAAb,CAAJ,EAAjB;AACD;;AAED,cAAc,SAAd,CAAwB,aAAxB,GAAwC,UAAS,EAAT,EAAa;AACnD,MAAI,cAAc,KAAK,eAAL,EAAlB;AACA,MAAI,UAAc,KAAK,QAAvB;AACA,MAAI,YAAc,IAAlB;;AAEA,MAAI,gBAAgB,IAApB,EAA0B;AACxB,QAAI,MAAM,IAAV;;AAEA,QAAI,KAAK,QAAL,CAAc,YAAd,CAA2B,KAAK,QAAhC,EAA0C,IAA1C,EAAgD,MAAhD,KAA2D,CAA/D,EAAkE;AAChE,YAAM,IAAI,KAAJ,CAAU,iCAAV,CAAN;AACA,UAAI,IAAJ,GAAW,iBAAX;AACD,KAHD,MAGO;AACL,YAAM,IAAI,KAAJ,CAAU,sBAAV,CAAN;AACA,UAAI,IAAJ,GAAW,cAAX;AACD;;AAED,WAAO,GAAG,GAAH,CAAP;AACD;;AAED,UAAQ,cAAR,CAAuB,WAAvB,EAAoC,UAAS,GAAT,EAAc,UAAd,EAA0B;AAC5D,QAAI,QAAQ,OAAO,QAAQ,SAAf,IACP,QAAQ,YAAR,CAAqB,UAAU,QAA/B,EAAyC,MAAzC,KAAoD,CADzD;;AAGA,QAAI,KAAJ,EAAW;AACT,aAAO,UAAU,aAAV,CAAwB,EAAxB,CAAP;AACD;;AAED,QAAI,GAAJ,EAAS;AACP,aAAO,GAAG,GAAH,CAAP;AACD;;AAED,OAAG,IAAH,EAAS,UAAT;AACD,GAbD;AAcD,CAjCD;;AAmCA,cAAc,SAAd,CAAwB,eAAxB,GAA0C,SAAS,eAAT,GAA2B;AACnE,MAAI,eAAe,KAAK,QAAL,CAAc,YAAd,CAA2B,KAAK,QAAhC,CAAnB;AACA,MAAI,MAAJ;;AAEA,UAAQ,aAAa,MAArB;AACE,SAAK,CAAL;AACE,eAAS,IAAT;AACA;AACF,SAAK,CAAL;AACE,eAAS,aAAa,CAAb,CAAT;AACA;AACF;AACE,eAAS,KAAK,SAAL,CAAe,YAAf,CAAT;AACA;AATJ;;AAYA,SAAO,WAAW,IAAX,GACH,KAAK,QAAL,CAAc,QAAd,CAAuB,MAAvB,CADG,GAEH,IAFJ;AAGD,CAnBD","file":"PoolNamespace-compiled.js","sourcesContent":["var PoolSelector = require('./PoolSelector');\n\nmodule.exports = PoolNamespace;\n\n/**\n * PoolNamespace\n */\nfunction PoolNamespace(cluster, pattern, selector) {\n  this._cluster = cluster;\n  this._pattern = pattern;\n  this._selector = new PoolSelector[selector]();\n}\n\nPoolNamespace.prototype.getConnection = function(cb) {\n  var clusterNode = this._getClusterNode();\n  var cluster     = this._cluster;\n  var namespace   = this;\n\n  if (clusterNode === null) {\n    var err = null;\n\n    if (this._cluster._findNodeIds(this._pattern, true).length !== 0) {\n      err = new Error('Pool does not have online node.');\n      err.code = 'POOL_NONEONLINE';\n    } else {\n      err = new Error('Pool does not exist.');\n      err.code = 'POOL_NOEXIST';\n    }\n\n    return cb(err);\n  }\n\n  cluster._getConnection(clusterNode, function(err, connection) {\n    var retry = err && cluster._canRetry\n      && cluster._findNodeIds(namespace._pattern).length !== 0;\n\n    if (retry) {\n      return namespace.getConnection(cb);\n    }\n\n    if (err) {\n      return cb(err);\n    }\n\n    cb(null, connection);\n  });\n};\n\nPoolNamespace.prototype._getClusterNode = function _getClusterNode() {\n  var foundNodeIds = this._cluster._findNodeIds(this._pattern);\n  var nodeId;\n\n  switch (foundNodeIds.length) {\n    case 0:\n      nodeId = null;\n      break;\n    case 1:\n      nodeId = foundNodeIds[0];\n      break;\n    default:\n      nodeId = this._selector(foundNodeIds);\n      break;\n  }\n\n  return nodeId !== null\n    ? this._cluster._getNode(nodeId)\n    : null;\n};\n"]}