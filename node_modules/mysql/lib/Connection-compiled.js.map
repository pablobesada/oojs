{"version":3,"sources":["Connection.js"],"names":[],"mappings":"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","file":"Connection-compiled.js","sourcesContent":["var Crypto           = require('crypto');\nvar Net              = require('net');\nvar tls              = require('tls');\nvar ConnectionConfig = require('./ConnectionConfig');\nvar Protocol         = require('./protocol/Protocol');\nvar SqlString        = require('./protocol/SqlString');\nvar Query            = require('./protocol/sequences/Query');\nvar EventEmitter     = require('events').EventEmitter;\nvar Util             = require('util');\n\nmodule.exports = Connection;\nUtil.inherits(Connection, EventEmitter);\nfunction Connection(options) {\n  EventEmitter.call(this);\n\n  this.config = options.config;\n\n  this._socket        = options.socket;\n  this._protocol      = new Protocol({config: this.config, connection: this});\n  this._connectCalled = false;\n  this.state          = \"disconnected\";\n  this.threadId       = null;\n}\n\nfunction bindToCurrentDomain(callback) {\n  if (!callback) return;\n\n  var domain = process.domain;\n\n  return domain\n    ? domain.bind(callback)\n    : callback;\n}\n\nConnection.createQuery = function createQuery(sql, values, callback) {\n  if (sql instanceof Query) {\n    return sql;\n  }\n\n  var cb      = bindToCurrentDomain(callback);\n  var options = {};\n\n  if (typeof sql === 'function') {\n    cb = bindToCurrentDomain(sql);\n    return new Query(options, cb);\n  }\n\n  if (typeof sql === 'object') {\n    for (var prop in sql) {\n      options[prop] = sql[prop];\n    }\n\n    if (typeof values === 'function') {\n      cb = bindToCurrentDomain(values);\n    } else if (values !== undefined) {\n      options.values = values;\n    }\n\n    return new Query(options, cb);\n  }\n\n  options.sql    = sql;\n  options.values = values;\n\n  if (typeof values === 'function') {\n    cb = bindToCurrentDomain(values);\n    options.values = undefined;\n  }\n\n  if (cb === undefined && callback !== undefined) {\n    throw new TypeError('argument callback must be a function when provided');\n  }\n\n  return new Query(options, cb);\n};\n\nConnection.prototype.connect = function connect(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (!this._connectCalled) {\n    this._connectCalled = true;\n\n    // Connect either via a UNIX domain socket or a TCP socket.\n    this._socket = (this.config.socketPath)\n      ? Net.createConnection(this.config.socketPath)\n      : Net.createConnection(this.config.port, this.config.host);\n\n    var connection = this;\n    this._protocol.on('data', function(data) {\n       connection._socket.write(data);\n    });\n    this._socket.on('data', function(data) {\n      connection._protocol.write(data);\n    });\n    this._protocol.on('end', function() {\n       connection._socket.end();\n    });\n    this._socket.on('end', function(err) {\n      connection._protocol.end();\n    });\n\n    this._socket.on('error', this._handleNetworkError.bind(this));\n    this._socket.on('connect', this._handleProtocolConnect.bind(this));\n    this._protocol.on('handshake', this._handleProtocolHandshake.bind(this));\n    this._protocol.on('unhandledError', this._handleProtocolError.bind(this));\n    this._protocol.on('drain', this._handleProtocolDrain.bind(this));\n    this._protocol.on('end', this._handleProtocolEnd.bind(this));\n    this._protocol.on('enqueue', this._handleProtocolEnqueue.bind(this));\n\n    if (this.config.connectTimeout) {\n      var handleConnectTimeout = this._handleConnectTimeout.bind(this);\n\n      this._socket.setTimeout(this.config.connectTimeout, handleConnectTimeout);\n      this._socket.once('connect', function() {\n        this.setTimeout(0, handleConnectTimeout);\n      });\n    }\n  }\n\n  this._protocol.handshake(options, bindToCurrentDomain(callback));\n};\n\nConnection.prototype.changeUser = function changeUser(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n\n  var charsetNumber = (options.charset)\n    ? ConnectionConfig.getCharsetNumber(options.charset)\n    : this.config.charsetNumber;\n\n  return this._protocol.changeUser({\n    user          : options.user || this.config.user,\n    password      : options.password || this.config.password,\n    database      : options.database || this.config.database,\n    timeout       : options.timeout,\n    charsetNumber : charsetNumber,\n    currentConfig : this.config\n  }, bindToCurrentDomain(callback));\n};\n\nConnection.prototype.beginTransaction = function beginTransaction(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'START TRANSACTION';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.commit = function commit(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'COMMIT';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.rollback = function rollback(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  options = options || {};\n  options.sql = 'ROLLBACK';\n  options.values = null;\n\n  return this.query(options, callback);\n};\n\nConnection.prototype.query = function query(sql, values, cb) {\n  var query = Connection.createQuery(sql, values, cb);\n  query._connection = this;\n\n  if (!(typeof sql == 'object' && 'typeCast' in sql)) {\n    query.typeCast = this.config.typeCast;\n  }\n\n  if (query.sql) {\n    query.sql = this.format(query.sql, query.values);\n  }\n\n  this._implyConnect();\n\n  return this._protocol._enqueue(query);\n};\n\nConnection.prototype.ping = function ping(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n  this._protocol.ping(options, bindToCurrentDomain(callback));\n};\n\nConnection.prototype.statistics = function statistics(options, callback) {\n  if (!callback && typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  this._implyConnect();\n  this._protocol.stats(options, bindToCurrentDomain(callback));\n};\n\nConnection.prototype.end = function end(options, callback) {\n  var cb   = callback;\n  var opts = options;\n\n  if (!callback && typeof options === 'function') {\n    cb   = options;\n    opts = null;\n  }\n\n  // create custom options reference\n  opts = Object.create(opts || null);\n\n  if (opts.timeout === undefined) {\n    // default timeout of 30 seconds\n    opts.timeout = 30000;\n  }\n\n  this._implyConnect();\n  this._protocol.quit(opts, bindToCurrentDomain(cb));\n};\n\nConnection.prototype.destroy = function() {\n  this.state = \"disconnected\";\n  this._implyConnect();\n  this._socket.destroy();\n  this._protocol.destroy();\n};\n\nConnection.prototype.pause = function() {\n  this._socket.pause();\n  this._protocol.pause();\n};\n\nConnection.prototype.resume = function() {\n  this._socket.resume();\n  this._protocol.resume();\n};\n\nConnection.prototype.escape = function(value) {\n  return SqlString.escape(value, false, this.config.timezone);\n};\n\nConnection.prototype.escapeId = function escapeId(value) {\n  return SqlString.escapeId(value, false);\n};\n\nConnection.prototype.format = function(sql, values) {\n  if (typeof this.config.queryFormat == \"function\") {\n    return this.config.queryFormat.call(this, sql, values, this.config.timezone);\n  }\n  return SqlString.format(sql, values, this.config.stringifyObjects, this.config.timezone);\n};\n\nif (tls.TLSSocket) {\n  // 0.11+ environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    var connection    = this;\n    var secureContext = tls.createSecureContext({\n      ca         : this.config.ssl.ca,\n      cert       : this.config.ssl.cert,\n      ciphers    : this.config.ssl.ciphers,\n      key        : this.config.ssl.key,\n      passphrase : this.config.ssl.passphrase\n    });\n\n    // \"unpipe\"\n    this._socket.removeAllListeners('data');\n    this._protocol.removeAllListeners('data');\n\n    // socket <-> encrypted\n    var rejectUnauthorized = this.config.ssl.rejectUnauthorized;\n    var secureEstablished  = false;\n    var secureSocket       = new tls.TLSSocket(this._socket, {\n      rejectUnauthorized : rejectUnauthorized,\n      requestCert        : true,\n      secureContext      : secureContext,\n      isServer           : false\n    });\n\n    // error handler for secure socket\n    secureSocket.on('_tlsError', function(err) {\n      if (secureEstablished) {\n        connection._handleNetworkError(err);\n      } else {\n        onSecure(err);\n      }\n    })\n\n    // cleartext <-> protocol\n    secureSocket.pipe(this._protocol);\n    this._protocol.on('data', function(data) {\n      secureSocket.write(data);\n    });\n\n    secureSocket.on('secure', function() {\n      secureEstablished = true;\n\n      onSecure(rejectUnauthorized ? this.ssl.verifyError() : null);\n    });\n\n    // start TLS communications\n    secureSocket._start();\n  };\n} else {\n  // pre-0.11 environment\n  Connection.prototype._startTLS = function _startTLS(onSecure) {\n    // before TLS:\n    //  _socket <-> _protocol\n    // after:\n    //  _socket <-> securePair.encrypted <-> securePair.cleartext <-> _protocol\n\n    var connection  = this;\n    var credentials = Crypto.createCredentials({\n      ca         : this.config.ssl.ca,\n      cert       : this.config.ssl.cert,\n      ciphers    : this.config.ssl.ciphers,\n      key        : this.config.ssl.key,\n      passphrase : this.config.ssl.passphrase\n    });\n\n    var rejectUnauthorized = this.config.ssl.rejectUnauthorized;\n    var secureEstablished  = false;\n    var securePair         = tls.createSecurePair(credentials, false, true, rejectUnauthorized);\n\n    // error handler for secure pair\n    securePair.on('error', function(err) {\n      if (secureEstablished) {\n        connection._handleNetworkError(err);\n      } else {\n        onSecure(err);\n      }\n    });\n\n    // \"unpipe\"\n    this._socket.removeAllListeners('data');\n    this._protocol.removeAllListeners('data');\n\n    // socket <-> encrypted\n    securePair.encrypted.pipe(this._socket);\n    this._socket.on('data', function(data) {\n      securePair.encrypted.write(data);\n    });\n\n    // cleartext <-> protocol\n    securePair.cleartext.pipe(this._protocol);\n    this._protocol.on('data', function(data) {\n      securePair.cleartext.write(data);\n    });\n\n    // secure established\n    securePair.on('secure', function() {\n      secureEstablished = true;\n\n      if (!rejectUnauthorized) {\n        onSecure();\n        return;\n      }\n\n      var verifyError = this.ssl.verifyError();\n      var err = verifyError;\n\n      // node.js 0.6 support\n      if (typeof err === 'string') {\n        err = new Error(verifyError);\n        err.code = verifyError;\n      }\n\n      onSecure(err);\n    });\n\n    // node.js 0.8 bug\n    securePair._cycle = securePair.cycle;\n    securePair.cycle  = function cycle() {\n      if (this.ssl && this.ssl.error) {\n        this.error();\n      }\n\n      return this._cycle.apply(this, arguments);\n    };\n  };\n}\n\nConnection.prototype._handleConnectTimeout = function() {\n  if (this._socket) {\n    this._socket.setTimeout(0);\n    this._socket.destroy();\n  }\n\n  var err = new Error('connect ETIMEDOUT');\n  err.errorno = 'ETIMEDOUT';\n  err.code = 'ETIMEDOUT';\n  err.syscall = 'connect';\n\n  this._handleNetworkError(err);\n};\n\nConnection.prototype._handleNetworkError = function(err) {\n  this._protocol.handleNetworkError(err);\n};\n\nConnection.prototype._handleProtocolError = function(err) {\n  this.state = \"protocol_error\";\n  this.emit('error', err);\n};\n\nConnection.prototype._handleProtocolDrain = function() {\n  this.emit('drain');\n};\n\nConnection.prototype._handleProtocolConnect = function() {\n  this.state = \"connected\";\n  this.emit('connect');\n};\n\nConnection.prototype._handleProtocolHandshake = function _handleProtocolHandshake(packet) {\n  this.state    = \"authenticated\";\n  this.threadId = packet.threadId;\n};\n\nConnection.prototype._handleProtocolEnd = function(err) {\n  this.state = \"disconnected\";\n  this.emit('end', err);\n};\n\nConnection.prototype._handleProtocolEnqueue = function _handleProtocolEnqueue(sequence) {\n  this.emit('enqueue', sequence);\n};\n\nConnection.prototype._implyConnect = function() {\n  if (!this._connectCalled) {\n    this.connect();\n  }\n};\n"]}