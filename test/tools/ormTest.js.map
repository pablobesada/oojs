{"version":3,"sources":["ormTest.es6"],"names":[],"mappings":"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","file":"ormTest.js","sourcesContent":["\"use strict\";\nvar app = require(\"./../../app\")\nvar chance = new require(\"chance\")()\nvar _ = require(\"underscore\")\nvar oo = require(\"openorange\")\nvar Query = oo.query;\nvar cm = oo.classmanager\nvar should = require('should');\nvar async = require('async')\nvar utils = require(\"../utils\")\n\nvar webdriver = require('selenium-webdriver');\nlet By = webdriver.By,\n    until = webdriver.until;\n\nlet port = 4001\n\nfunction wait(t) {\n    return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n            resolve()\n        }, t)\n    });\n}\n\nlet Record = cm.getClass(\"Record\");\ndescribe('ORM with Selenium', function () {\n    before(async ()=> {\n        console.log(\"en before\")\n        app.serve(port);\n        let q = await oo.getDBConnection()\n        await q.query(\"delete from TestRecord\")\n        await q.query(\"delete from TestRecordRow\")\n        await q.query(\"delete from TestRecord2\")\n        oo.commit();\n    });\n\n    this.timeout(30000)\n    it('Concurrent transaccions from different browsers', async () => {\n        let runs = [true,false,false,true]\n        let responses = [];\n        for (let i in runs) {\n            let driver = new webdriver.Builder().forBrowser('chrome').build();\n            driver.get(`localhost:${port}/app/index`);\n            driver.manage().timeouts().setScriptTimeout(200000);\n            let command = `cm.getClass('ORMBrowserTests').test1('T${i}', ${runs[i]}, arguments[arguments.length - 1])`\n            console.log(command)\n            let resp = driver.executeAsyncScript(command)//.then(function (res) {callback(res)})\")\n            responses.push([driver, resp]);\n        }\n        console.log(\"-----------------------------------------------------------------------------------------------\")\n        await wait(20000);\n        for (let i in responses) {\n            let resp = responses[i][1];\n            let driver = responses[i][0];\n            responses[i] = await resp;\n            driver.quit();\n        }\n        for (let j in responses) {\n            let res = responses[j]\n            for (let i = 0; i < res.should_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_exist[i]))\n                should.exist(await cm.getClass(r.__class__.__description__.name).findOne({internalId: r.internalId, String_Field: r.String_Field}), \"El registro deberia existir\")\n            }\n            for (let i = 0; i < res.should_not_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_not_exist[i]))\n                should.not.exist(await cm.getClass(r.__class__.__description__.name).findOne({String_Field: r.String_Field}), \"El registro deberia existir\")\n            }\n        }\n    });\n});"]}