{"version":3,"sources":["ormTest.es6"],"names":[],"mappings":"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","file":"ormTest.js","sourcesContent":["\"use strict\";\nvar app = require(\"./../../app\")\nvar chance = new require(\"chance\")()\nvar _ = require(\"underscore\")\nvar oo = require(\"openorange\")\nvar Query = oo.query;\nvar cm = oo.classmanager\nvar should = require('should');\nvar async = require('async')\nvar utils = require(\"../utils\")\n\nvar webdriver = require('selenium-webdriver');\nlet By = webdriver.By,\n    until = webdriver.until,\n    actions = webdriver.ActionSequence;\n\nlet port = 3999\n\nfunction wait(t) {\n    return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n            resolve()\n        }, t)\n    });\n}\n\nlet Record = cm.getClass(\"Record\");\ndescribe('ORM with Selenium', function () {\n    before(async ()=> {\n        app.serve(port);\n        let q = await oo.getDBConnection()\n        await q.query(\"delete from TestRecord\")\n        await q.query(\"delete from TestRecordRow\")\n        await q.query(\"delete from TestRecord2\")\n        oo.commit();\n    });\n\n    this.timeout(40000)\n    it('Concurrent transaccions from different browsers', async () => {\n        //let runs = [true,false,false,true]\n        let runs = [false]\n        let responses = [];\n        for (let i in runs) {\n            let driver = new webdriver.Builder().forBrowser('chrome').build();\n            driver.get(`localhost:${port}/oo/ui`);\n            //console.log(await driver.findElement(By.id(\"username\")))\n            let usernameElement = (await driver.findElement(By.id(\"username\")))\n            usernameElement.sendKeys(\"PDB\");\n            usernameElement.sendKeys(webdriver.Key.TAB);\n            let passwordElement = (await driver.findElement(By.id(\"password\")))\n            passwordElement.sendKeys(\"123\");\n            passwordElement.sendKeys(webdriver.Key.TAB);\n            let loginFormElement = (await driver.findElement(By.id(\"loginButton\")))\n            await wait(1000) //feo, pero funciona\n            loginFormElement.click();\n            //let action = new actions(driver);\n            //action.moveToElement(loginFormElement).click().perform();\n            driver.manage().timeouts().setScriptTimeout(200000);\n            let command = `require(\"openorange\").classmanager.getClass('ORMBrowserTests').test1('T${i}', ${runs[i]}, arguments[arguments.length - 1])`\n            console.log(command)\n            let resp = driver.executeAsyncScript(command)//.then(function (res) {callback(res)})\")\n            responses.push([driver, resp]);\n        }\n        console.log(\"-----------------------------------------------------------------------------------------------\")\n        await wait(20000);\n        await oo.rollback(); //para poder ver los cambios\n        await oo.beginTransaction(); //para poder ver los cambios\n        for (let i in responses) {\n            let resp = responses[i][1];\n            let driver = responses[i][0];\n            responses[i] = await resp;\n            driver.quit();\n        }\n        for (let j in responses) {\n            let res = responses[j]\n            for (let i = 0; i < res.should_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_exist[i]))\n                should.exist(await cm.getClass(r.__class__.__description__.name).findOne({internalId: r.internalId, String_Field: r.String_Field}), \"El registro deberia existir: \" + r.String_Field)\n            }\n            for (let i = 0; i < res.should_not_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_not_exist[i]))\n                should.not.exist(await cm.getClass(r.__class__.__description__.name).findOne({String_Field: r.String_Field}), \"El registro no deberia existir: \" + r.String_Field)\n            }\n        }\n    });\n});"]}