{"version":3,"sources":["ormTest.es6"],"names":[],"mappings":"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","file":"ormTest.js","sourcesContent":["\"use strict\";\nvar app = require(\"./../../app\")\nvar chance = new require(\"chance\")()\nvar _ = require(\"underscore\")\nvar oo = require(\"openorange\")\nvar Query = oo.query;\nvar cm = oo.classmanager\nvar should = require('should');\nvar async = require('async')\nvar utils = require(\"../utils\")\n\nvar webdriver = require('selenium-webdriver');\nlet By = webdriver.By,\n    until = webdriver.until,\n    actions = webdriver.ActionSequence;\n\nlet port = 4001\n\nfunction wait(t) {\n    return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n            resolve()\n        }, t)\n    });\n}\n\nlet Record = cm.getClass(\"Record\");\ndescribe('ORM with Selenium', function () {\n    before(async ()=> {\n        app.serve(port);\n        let q = await oo.getDBConnection()\n        await q.query(\"delete from TestRecord\")\n        await q.query(\"delete from TestRecordRow\")\n        await q.query(\"delete from TestRecord2\")\n        oo.commit();\n    });\n\n    this.timeout(40000)\n    it('Concurrent transaccions from different browsers', async () => {\n        let runs = [true,false,false,true]\n        let responses = [];\n        for (let i in runs) {\n            let driver = new webdriver.Builder().forBrowser('chrome').build();\n            driver.get(`localhost:${port}/oo/ui`);\n            //console.log(await driver.findElement(By.id(\"username\")))\n            let usernameElement = (await driver.findElement(By.id(\"username\")))\n            usernameElement.sendKeys(\"PDB\");\n            usernameElement.sendKeys(webdriver.Key.TAB);\n            let passwordElement = (await driver.findElement(By.id(\"password\")))\n            passwordElement.sendKeys(\"123\");\n            passwordElement.sendKeys(webdriver.Key.TAB);\n            let loginFormElement = (await driver.findElement(By.id(\"loginButton\")))\n            await wait(1000) //feo, pero funciona\n            loginFormElement.click();\n            //let action = new actions(driver);\n            //action.moveToElement(loginFormElement).click().perform();\n            driver.manage().timeouts().setScriptTimeout(200000);\n            let command = `require(\"openorange\").classmanager.getClass('ORMBrowserTests').test1('T${i}', ${runs[i]}, arguments[arguments.length - 1])`\n            console.log(command)\n            let resp = driver.executeAsyncScript(command)//.then(function (res) {callback(res)})\")\n            responses.push([driver, resp]);\n        }\n        console.log(\"-----------------------------------------------------------------------------------------------\")\n        await wait(20000);\n        for (let i in responses) {\n            let resp = responses[i][1];\n            let driver = responses[i][0];\n            responses[i] = await resp;\n            driver.quit();\n        }\n        for (let j in responses) {\n            let res = responses[j]\n            for (let i = 0; i < res.should_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_exist[i]))\n                should.exist(await cm.getClass(r.__class__.__description__.name).findOne({internalId: r.internalId, String_Field: r.String_Field}), \"El registro deberia existir\")\n            }\n            for (let i = 0; i < res.should_not_exist.length; i++) {\n                let r = Record.fromJSON(JSON.parse(res.should_not_exist[i]))\n                should.not.exist(await cm.getClass(r.__class__.__description__.name).findOne({String_Field: r.String_Field}), \"El registro deberia existir\")\n            }\n        }\n    });\n});"]}