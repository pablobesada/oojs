{"version":3,"sources":["TestRecord.es6"],"names":[],"mappings":"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","file":"TestRecord.js","sourcesContent":["\"use strict\";\nvar cm = require('openorange').classmanager\nlet _ = require(\"underscore\")\nlet chance = require(\"chance\")()\nlet moment = require(\"moment\")\n\n\nvar Description = {\n    name: 'TestRecord',\n    inherits: 'Record',\n    fields: {\n        TestName: {type: \"string\", length: 60},\n        SubTestName: {type: \"string\", length: 60},\n        String_Field: {type: \"string\", length: 60},\n        Integer_Field: {type: \"integer\"},\n        NonPersistent_Field: {type: \"string\", length:60, persistent: false},\n        Date_Field: {type: \"date\"},\n        Rows: {type: \"detail\", class: \"TestRecordRow\"},\n        NonPersistent_Rows: {type: \"detail\", class: \"NonPersistent_TestRecordRow\", persistent: false}\n    },\n    filename: __filename,\n}\n\nlet Parent = cm.SuperClass(Description)\n\nclass TestRecord extends Parent {\n\n    constructor() {\n        super()\n        this.waitBeforeReturningFromCheck = 0;\n        this.waitBeforeStoringRecordsInBeforeInsert = 0;\n        this.checkReturnValue = true;\n        this.beforeInsertReturnValue = true;\n        this.beforeUpdateReturnValue = true;\n        this.beforeInsert_recordsToStore = [];\n    }\n\n    async check(){\n        let res = await Parent.tryCall(this, true, \"check\");\n        if (!res) return res;\n        if (this.waitBeforeReturningFromCheck > 0) await TestRecord.wait(this.waitBeforeReturningCheck);\n        return this.checkReturnValue;\n    }\n\n    static wait(t) {\n        return new Promise(function (resolve, reject) {\n            setTimeout(function () {\n                resolve()\n            },t)\n        });\n    }\n    async beforeInsert(){\n        let self = this;\n        let res = await Parent.tryCall(this, true, \"beforeInsert\");\n        if (!res) return res;\n        for (let i in this.beforeInsert_recordsToStore) {\n            let record = this.beforeInsert_recordsToStore[i];\n            if (this.waitBeforeStoringRecordsInBeforeInsert > 0) await TestRecord.wait(this.waitBeforeStoringRecordsInBeforeInsert);\n            let res = await record.store();\n            if (!res) throw new Error(\"no se pudo grabar registro dentro de beforeInsert\")\n        }\n        return self.beforeInsertReturnValue;\n    }\n\n    async beforeUpdate(){\n        let res = await Parent.tryCall(this, true, \"beforeUpdate\");\n        if (!res) return res;\n        return this.beforeUpdateReturnValue;\n    }\n\n    static fillRecordWithRandomValues(record) {\n        let cls = this;\n        _(record.persistentFieldNames()).forEach(function(fn) {\n            let fielddef = record.fields(fn)\n            if (fn == 'internalId') return;\n            if (fn == 'masterId') return;\n            if (fn == 'rowNr') return;\n            switch (fielddef.type) {\n                case 'string':\n                    record[fn] = chance.word({length: fielddef.length});\n                    break;\n                case 'integer':\n                    record[fn] = chance.integer({min: -10000, max: 10000});\n                    break;\n                case 'date':\n                    let v = new moment()\n                    record[fn] = v\n                    break;\n                case 'time':\n                    record[fn] = '07:04:33'\n                    break;\n            }\n        });\n        _(record.persistentDetailNames()).forEach(function (dn) {\n            let detail = record[dn];\n            var nrows = chance.natural({min: 4, max: 13})\n            for (var j = 0; j < nrows; j++) {\n                //console.log(fn)\n                var row = detail.newRow()\n                cls.fillRecordWithRandomValues(row)\n                detail.push(row);\n            }\n        });\n        return record;\n    }\n\n    fillWithRandomValues() {\n        return this.__class__.fillRecordWithRandomValues(this);\n    }\n\n    static async newSavedRecord() {\n        let rec = this.new().fillWithRandomValues();\n        if (await rec.store()) return rec;\n        return null;\n\n    }\n\n}\n\nmodule.exports = TestRecord.initClass(Description)\n"]}