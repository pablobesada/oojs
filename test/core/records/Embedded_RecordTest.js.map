{"version":3,"sources":["Embedded_RecordTest.es6"],"names":[],"mappings":"AAAA;;;;;AAEA,IAAI,SAAS,IAAI,OAAJ,CAAY,QAAZ,GAAb;AACA,IAAI,IAAI,QAAQ,YAAR,CAAR;AACA,IAAI,KAAK,QAAQ,YAAR,CAAT;AACA,IAAI,QAAQ,GAAG,KAAf;AACA,IAAI,KAAK,GAAG,YAAZ;AACA,IAAI,SAAS,QAAQ,QAAR,CAAb;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;AACA,IAAI,QAAQ,IAAZ;;AAEA,SAAS,iBAAT,EAA4B,YAAY;AAAA;;AACpC,QAAI,MAAM,GAAG,QAAH,CAAY,YAAZ,CAAV;AACA,QAAI,MAAM,IAAV;AACA,QAAI,eAAe,IAAnB;;AAEA,OAAG,gCAAH,4CAAqC;AAAA,YAG7B,GAH6B;AAAA;AAAA;AAAA;AAAA;AACjC,8BAAM,IAAI,GAAJ,EAAN;AACA,8BAAM,UAAN,CAAiB,GAAjB;AAFiC;AAAA,+BAGjB,IAAI,KAAJ,EAHiB;;AAAA;AAG7B,2BAH6B;;AAIjC,4BAAI,MAAJ,CAAW,EAAX,CAAc,IAAd;AACA,uCAAe,IAAI,KAAJ,EAAf;;AALiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAArC;;AAQA,OAAG,MAAH,4CAAW;AAAA,YAGH,GAHG;AAAA;AAAA;AAAA;AAAA;AACP,8BAAM,IAAI,GAAJ,EAAN;AACA,4BAAI,UAAJ,GAAiB,aAAa,UAA9B;AAFO;AAAA,+BAGS,IAAI,IAAJ,EAHT;;AAAA;AAGH,2BAHG;;AAIP,4BAAI,MAAJ,CAAW,EAAX,CAAc,IAAd,CAAmB,aAAnB;AACA,qCAAa,aAAb;AACA,4BAAI,OAAJ,CAAY,YAAZ,EAA0B,MAA1B,CAAiC,EAAjC,CAAoC,IAApC,CAAyC,sBAAzC;;AANO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAX;;AASA,OAAG,iDAAH,4CAAsD;AAAA,YAC9C,EAD8C,EAE9C,EAF8C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BACnC,IAAI,cAAJ,EADmC;;AAAA;AAC9C,0BAD8C;AAAA;AAAA,+BAEnC,IAAI,OAAJ,CAAY,EAAC,YAAY,GAAG,UAAhB,EAAZ,CAFmC;;AAAA;AAE9C,0BAF8C;;AAGlD,+BAAO,GAAG,OAAH,CAAW,EAAX,CAAP,EAAuB,EAAvB,CAA0B,IAA1B;AACA,2BAAG,aAAH;AAJkD;AAAA,+BAKrC,GAAG,KAAH,EALqC;;AAAA;AAAA;AAKlD,8BALkD,eAKzB,EALyB;;AAMlD,2BAAG,aAAH;AANkD;AAAA,+BAOrC,GAAG,KAAH,EAPqC;;AAAA;AAAA;AAOlD,8BAPkD,eAOzB,GAPyB,CAOrB,EAPqB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAtD;;AAUA,OAAG,6CAAH,4CAAkD;AAAA,YAC1C,EAD0C,EAE1C,EAF0C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAC/B,IAAI,cAAJ,EAD+B;;AAAA;AAC1C,0BAD0C;AAAA;AAAA,+BAE/B,IAAI,OAAJ,CAAY,EAAC,YAAY,GAAG,UAAhB,EAAZ,CAF+B;;AAAA;AAE1C,0BAF0C;;AAG9C,+BAAO,GAAG,OAAH,CAAW,EAAX,CAAP,EAAuB,EAAvB,CAA0B,IAA1B;AACA,2BAAG,IAAH,CAAQ,CAAR,EAAW,aAAX;AAJ8C;AAAA,+BAKjC,GAAG,KAAH,EALiC;;AAAA;AAAA;AAK9C,8BAL8C,eAKrB,EALqB;;AAM9C,2BAAG,IAAH,CAAQ,CAAR,EAAW,aAAX;AAN8C;AAAA,+BAOjC,GAAG,KAAH,EAPiC;;AAAA;AAAA;AAO9C,8BAP8C,eAOrB,GAPqB,CAOjB,EAPiB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlD;;AAWA,OAAG,aAAH,4CAAkB;AAAA;AAAA;AAAA;AAAA;AACd,8BAAM,IAAI,GAAJ,EAAN;AACA,8BAAM,UAAN,CAAiB,GAAjB;AAFc;AAAA,+BAGD,IAAI,IAAJ,EAHC;;AAAA;AAAA;AAGd,8BAHc,eAGW,EAHX,CAGc,IAHd,CAGmB,kBAHnB;AAAA,uCAId,MAJc;AAAA;AAAA,+BAIK,IAAI,OAAJ,CAAY,EAAC,YAAY,IAAI,UAAjB,EAA6B,eAAe,IAAI,aAAhD,EAAZ,CAJL;;AAAA;AAAA;;AAAA,qCAIP,KAJO,kCAIkF,0DAJlF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlB;;AAOA,OAAG,sBAAH,4CAA2B;AAAA,YACnB,UADmB,EAMnB,GANmB;AAAA;AAAA;AAAA;AAAA;AACnB,kCADmB,GACN,IAAI,UADE;AAAA;AAAA,+BAEX,IAAI,OAAJ,CAAY,EAAC,YAAY,IAAI,UAAjB,EAAZ,CAFW;;AAAA;AAEvB,2BAFuB;;AAGvB,+BAAO,KAAP,CAAa,GAAb;AACA,4BAAI,gBAAJ,GAAuB,KAAvB;AACA,4BAAI,aAAJ;AALuB;AAAA,+BAMP,IAAI,IAAJ,EANO;;AAAA;AAMnB,2BANmB;;AAOvB,4BAAI,MAAJ,CAAW,EAAX,CAAc,KAAd,CAAoB,4CAApB;AAPuB,uCAQvB,OAAO,GARgB;AAAA;AAAA,+BAQA,IAAI,OAAJ,CAAY,EAAC,YAAY,IAAI,UAAjB,EAA6B,eAAe,IAAI,aAAhD,EAAZ,CARA;;AAAA;AAAA;;AAAA,qCAQZ,KARY,kCAQ6E,sDAR7E;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA3B;;AAWA,OAAG,6BAAH,4CAAkC;AAAA,YAC1B,GAD0B,EAIrB,CAJqB,EAKtB,MALsB,EAU1B,GAV0B,EAarB,EAbqB,EActB,OAdsB;;AAAA;AAAA;AAAA;AAAA;AAC1B,2BAD0B,GACpB,IAAI,GAAJ,EADoB;;AAE9B,8BAAM,UAAN,CAAiB,GAAjB;AACA,4BAAI,uBAAJ,GAA8B,KAA9B;AACA,6BAAS,CAAT,GAAW,CAAX,EAAa,IAAE,CAAf,EAAiB,GAAjB,EAAsB;AACd,kCADc,GACL,IAAI,GAAJ,GAAU,oBAAV,EADK;;AAElB,mCAAO,WAAP,GAAqB,6BAArB;AACA,gCAAI,2BAAJ,CAAgC,IAAhC,CAAqC,MAArC;AACH;AACD,4BAAI,WAAJ,GAAkB,QAAlB;AAT8B;AAAA,+BAUd,IAAI,IAAJ,EAVc;;AAAA;AAU1B,2BAV0B;;AAW9B,+BAAO,GAAP,EAAY,EAAZ,CAAe,KAAf,CAAqB,0BAArB;AAX8B,uCAY9B,OAAO,GAZuB;AAAA;AAAA,+BAYP,IAAI,OAAJ,CAAY,EAAC,YAAY,IAAI,UAAjB,EAAZ,CAZO;;AAAA;AAAA;;AAAA,qCAYnB,KAZmB,kCAYoC,sDAZpC;;AAAA,+DAahB,IAAI,2BAbY;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAarB,0BAbqB;AActB,+BAdsB,GAcb,IAAI,2BAAJ,CAAgC,EAAhC,CAda;AAAA,uCAe1B,OAAO,GAfmB;AAAA;AAAA,+BAeH,IAAI,OAAJ,CAAY,EAAC,YAAY,QAAO,UAApB,EAAgC,cAAc,QAAO,YAArD,EAAZ,CAfG;;AAAA;AAAA;;AAAA,qCAef,KAfe,kCAe8E,4EAf9E;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlC;;AAmBA,OAAG,6BAAH,4CAAkC;AAAA,YAC1B,GAD0B,EAI1B,GAJ0B;AAAA;AAAA;AAAA;AAAA;AAC1B,2BAD0B,GACpB,IAAI,GAAJ,EADoB;;AAE9B,8BAAM,UAAN,CAAiB,GAAjB;AACA,4BAAI,uBAAJ,GAA8B,KAA9B;AAH8B;AAAA,+BAId,IAAI,IAAJ,EAJc;;AAAA;AAI1B,2BAJ0B;;AAK9B,+BAAO,GAAP,EAAY,EAAZ,CAAe,IAAf,CAAoB,uBAApB;AACA,4BAAI,aAAJ;AAN8B;AAAA,+BAOlB,IAAI,IAAJ,EAPkB;;AAAA;AAO9B,2BAP8B;;AAQ9B,+BAAO,GAAP,EAAY,EAAZ,CAAe,KAAf,CAAqB,0BAArB;AAR8B,uCAS9B,OAAO,GATuB;AAAA;AAAA,+BASP,IAAI,OAAJ,CAAY,EAAC,YAAY,IAAI,UAAjB,EAA6B,eAAe,IAAI,aAAhD,EAAZ,CATO;;AAAA;AAAA;;AAAA,qCASnB,KATmB,kCASsE,sDATtE;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAlC;AAWH,CA3FD;;AA6FA,OAAO,OAAP,GAAiB,SAAS,MAAT,CAAgB,WAAhB,EAA6B;AAC1C,YAAQ,WAAR;AACH,CAFD","file":"Embedded_RecordTest.js","sourcesContent":["\"use strict\";\n//var app = require(\"./../../app\")\nvar chance = new require(\"chance\")();\nvar _ = require(\"underscore\")\nvar oo = require(\"openorange\")\nvar Query = oo.query;\nvar cm = oo.classmanager\nvar should = require('should');\nvar async = require('async')\nlet utils = null;\n\ndescribe(\"Embedded_Record\", function () {\n    let cls = cm.getClass(\"TestRecord\");\n    let rec = null;\n    let original_rec = null;\n\n    it(\"create new record and store it\", async () => {\n        rec = cls.new()\n        utils.fillRecord(rec);\n        let res = await rec.store();\n        res.should.be.true();\n        original_rec = rec.clone();\n    })\n\n    it(\"load\", async () => {\n        rec = cls.new()\n        rec.internalId = original_rec.internalId;\n        var res = await rec.load();\n        res.should.be.true(\"no se grabo\");\n        original_rec.syncOldFields();\n        rec.isEqual(original_rec).should.be.true(\"registros diferentes\");\n    })\n\n    it(\"Concurrent store (storing with old syncVersion)\", async () => {\n        let r1 = await cls.newSavedRecord();\n        let r2 = await cls.findOne({internalId: r1.internalId})\n        should(r1.isEqual(r2)).be.true()\n        r1.Integer_Field++;\n        should(await r1.store()).ok()\n        r2.Integer_Field--;\n        should(await r2.store()).not.ok()\n    })\n\n    it(\"Detail integrity against master syncVersion\", async () => {\n        let r1 = await cls.newSavedRecord();\n        let r2 = await cls.findOne({internalId: r1.internalId})\n        should(r1.isEqual(r2)).be.true()\n        r1.Rows[0].Integer_Field++;\n        should(await r1.store()).ok()\n        r2.Rows[0].Integer_Field--;\n        should(await r2.store()).not.ok()\n\n    })\n\n    it(\"Save new OK\", async ()=> {\n        rec = cls.new()\n        utils.fillRecord(rec);\n        should(await rec.save()).be.true(\"El save no grabo\")\n        should.exist(await cls.findOne({internalId: rec.internalId, Integer_Field: rec.Integer_Field}), \"El save devolvio true, pero el registro no esta en la DB\")\n    })\n\n    it(\"Save with Check fail\", async ()=> {\n        let internalId = rec.internalId;\n        rec = await cls.findOne({internalId: rec.internalId})\n        should.exist(rec);\n        rec.checkReturnValue = false;\n        rec.Integer_Field++;\n        let res = await rec.save()\n        res.should.be.false(\"El save grabo y no deberia haberse grabado\")\n        should.not.exist(await cls.findOne({internalId: rec.internalId, Integer_Field: rec.Integer_Field}), \"El save devolvio false, pero igual grabo el registro\")\n    })\n\n    it(\"Save with beforeInsert fail\", async ()=> {\n        let rec = cls.new()\n        utils.fillRecord(rec)\n        rec.beforeInsertReturnValue = false;\n        for (let i=0;i<3;i++) {\n            let record = cls.new().fillWithRandomValues()\n            record.SubTestName = \"Save with beforeInsert fail\"\n            rec.beforeInsert_recordsToStore.push(record);\n        }\n        rec.SubTestName = 'PARENT'\n        let res = await rec.save()\n        should(res).be.false(\"No deberia haber grabado\")\n        should.not.exist(await cls.findOne({internalId: rec.internalId}), \"El save devolvio false, pero igual grabo el registro\")\n        for (let i in rec.beforeInsert_recordsToStore) {\n            let record = rec.beforeInsert_recordsToStore[i]\n            should.not.exist(await cls.findOne({internalId: record.internalId, String_Field: record.String_Field}), \"El save devolvio false, pero igual grabo registros dentro del beforeInsert\")\n        }\n    });\n\n    it(\"Save with beforeUpdate fail\", async ()=> {\n        let rec = cls.new()\n        utils.fillRecord(rec)\n        rec.beforeUpdateReturnValue = false;\n        let res = await rec.save()\n        should(res).be.true(\"Deberia haber grabado\");\n        rec.Integer_Field++;\n        res = await rec.save();\n        should(res).be.false(\"No Deberia haber grabado\");\n        should.not.exist(await cls.findOne({internalId: rec.internalId, Integer_Field: rec.Integer_Field}), \"El save devolvio false, pero igual grabo el registro\")\n    })\n});\n\nmodule.exports = function config(utilsModule) {\n    utils = utilsModule\n};"]}